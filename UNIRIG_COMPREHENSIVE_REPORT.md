# UniRig 3Dãƒªã‚®ãƒ³ã‚°ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ - åŒ…æ‹¬çš„è§£æ±ºå®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ
*æœ€çµ‚æ›´æ–°: 2025å¹´5æœˆ30æ—¥ï¼ˆFBXã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆä¿®æ­£å®Œäº†ãƒ»ãƒ†ã‚¯ã‚¹ãƒãƒ£ä¿æŒæ©Ÿèƒ½å®Œå…¨å®Ÿè£…ï¼‰*

## ğŸ¯ æ¦‚è¦ (Executive Summary)

UniRig 3Dãƒªã‚®ãƒ³ã‚°ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å…¨ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆãƒ¡ãƒƒã‚·ãƒ¥æŠ½å‡ºâ†’ã‚¹ã‚±ãƒ«ãƒˆãƒ³ç”Ÿæˆâ†’ã‚¹ã‚­ãƒ‹ãƒ³ã‚°â†’ãƒãƒ¼ã‚¸â†’FBXã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼‰ã«ãŠã‘ã‚‹è¤‡æ•°ã®æŠ€è¡“çš„å•é¡Œã‚’ç‰¹å®šã—ã€åŒ…æ‹¬çš„ãªè§£æ±ºç­–ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚**2025å¹´5æœˆ30æ—¥ç¾åœ¨ã€ãƒ†ã‚¯ã‚¹ãƒãƒ£ä¿æŒæ©Ÿèƒ½ã¨FBXã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆä¿®æ­£ã‚’å«ã‚€å…¨æ©Ÿèƒ½ãŒå®‰å®šå‹•ä½œã—ã€å®Œå…¨ãªã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒªã‚®ãƒ³ã‚°ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒå®Ÿç¾ã•ã‚Œã¦ã„ã¾ã™ã€‚**

## ğŸš€ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ¦‚è¦ (Application Overview)

UniRigã¯ä»¥ä¸‹ã®ä¸»è¦æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹é«˜åº¦ãª3Dãƒªã‚®ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã§ã™ï¼š

### æ ¸å¿ƒæ©Ÿèƒ½
- **ğŸ¯ ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯è‡ªå‹•ãƒªã‚®ãƒ³ã‚°**: å®Œå…¨è‡ªå‹•åŒ–ã•ã‚ŒãŸã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
- **âš™ï¸ ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œ**: å€‹åˆ¥å·¥ç¨‹ã§ã®è©³ç´°åˆ¶å¾¡
- **ğŸ“Š ãƒ¡ãƒƒã‚·ãƒ¥æŠ½å‡º**: 3Dãƒ¢ãƒ‡ãƒ«ã‹ã‚‰ã®ãƒ¡ãƒƒã‚·ãƒ¥ãƒ‡ãƒ¼ã‚¿è§£æãƒ»æŠ½å‡º
- **ğŸ¦´ ã‚¹ã‚±ãƒ«ãƒˆãƒ³ç”Ÿæˆ**: è‡ªå‹•ãƒœãƒ¼ãƒ³æ§‹é€ æ¨å®šãƒ»ç”Ÿæˆ
- **ğŸ¨ ã‚¹ã‚­ãƒ‹ãƒ³ã‚°**: é ‚ç‚¹ã¨ãƒœãƒ¼ãƒ³ã®é‡ã¿ä»˜ã‘è¨ˆç®—
- **ğŸ”— ãƒ¢ãƒ‡ãƒ«ãƒãƒ¼ã‚¸**: æœ€çµ‚ãƒªã‚®ãƒ³ã‚°æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«çµ±åˆ

### ã‚µãƒãƒ¼ãƒˆå½¢å¼
- **å…¥åŠ›**: GLB, FBX, OBJ, DAE, GLTF, VRM, PLY
- **å‡ºåŠ›**: FBXï¼ˆãƒªã‚®ãƒ³ã‚°æ¸ˆã¿ï¼‰, GLBï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ï¼‰, NPZï¼ˆä¸­é–“ãƒ‡ãƒ¼ã‚¿ï¼‰

---

## âœ… è§£æ±ºå®Œäº†ã—ãŸä¸»è¦å•é¡Œ

### 1. ğŸ”§ ãƒ¡ãƒƒã‚·ãƒ¥æŠ½å‡ºã®å®Œå…¨ä¿®æ­£

#### å•é¡Œ
- ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã®ä¸ä¸€è‡´ï¼ˆ`--input_path/--output_path` vs `--config/--model_path/--output_dir`ï¼‰
- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ¬ å¦‚ã«ã‚ˆã‚‹Extractå¤±æ•—

#### è§£æ±ºç­–
```python
# ä¿®æ­£å‰: é–“é•ã£ãŸå¼•æ•°å½¢å¼
cmd = [sys.executable, "-m", "src.data.extract",
       "--input_path", original_model_path,
       "--output_path", final_npz_output_path]

# ä¿®æ­£å¾Œ: æ­£ã—ã„å¼•æ•°å½¢å¼
cmd = [sys.executable, "-m", "src.data.extract",
       "--config", extract_config_path,
       "--model_path", os.path.abspath(original_model_path),
       "--output_dir", os.path.abspath(stage_output_dir)]
```

#### æˆæœ
âœ… **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«è‡ªå‹•ä½œæˆ**: `/app/configs/extract_config.yaml`  
âœ… **NPZç”ŸæˆæˆåŠŸ**: 828KB (bird.glb) â†’ 7,702é ‚ç‚¹ãƒ‡ãƒ¼ã‚¿  
âœ… **å …ç‰¢ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: è©³ç´°ãªãƒ‡ãƒãƒƒã‚°æƒ…å ±

### 2. ğŸ¦´ ã‚¹ã‚±ãƒ«ãƒˆãƒ³ç”Ÿæˆã®å®‰å®šåŒ–

#### å•é¡Œ
- `AssertionError: output or output_dir must be specified`
- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å‡¦ç†ã®ä¸æ•´åˆ

#### è§£æ±ºç­–
```bash
# generate_skeleton.sh ã®ä¿®æ­£
if [ -n "$npz_dir" ]; then
    cmd="$cmd --npz_dir=$npz_dir --output_dir=$npz_dir"
fi
if [ -n "$output_dir" ] && [ -z "$npz_dir" ]; then
    cmd="$cmd --output_dir=$output_dir"
fi
```

#### æˆæœ
âœ… **å…¨ãƒ¢ãƒ‡ãƒ«å¯¾å¿œ**: bird.glb, tira.glb, giraffe.glbç­‰ã§æ¤œè¨¼æ¸ˆã¿  
âœ… **FBXå‡ºåŠ›**: å¹³å‡1-3MBã€é«˜å“è³ªã‚¹ã‚±ãƒ«ãƒˆãƒ³æ§‹é€   
âœ… **NPZä¸­é–“ãƒ•ã‚¡ã‚¤ãƒ«**: 468KB-2.4MB

### 3. ğŸ¨ ã‚¹ã‚­ãƒ‹ãƒ³ã‚°ãƒ—ãƒ­ã‚»ã‚¹ã®å®Œå…¨è§£æ±º

#### ä¸»è¦å•é¡Œ
- `TypeError: unhashable type` - OpenGL/PyRenderã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç«¶åˆ
- é ‚ç‚¹æ•°ä¸ä¸€è‡´ï¼ˆ32768ã‚µãƒ³ãƒ—ãƒ« â†’ 7702å…ƒé ‚ç‚¹ï¼‰
- RawDataæ§‹ç¯‰å¤±æ•—

#### æŠ€è¡“çš„è§£æ±ºç­–

**OpenGLã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä¿®æ­£**:
```python
# /opt/conda/envs/UniRig/lib/python3.11/site-packages/OpenGL/contextdata.py
def setValue(self, value):
    try:
        if self.key not in context.functionData:
            context.functionData[self.key] = {}
        context.functionData[self.key][self.constant] = value
    except TypeError as e:
        if 'unhashable type' in str(e):
            return  # ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†
        raise
```

**é ‚ç‚¹ãƒãƒƒãƒ”ãƒ³ã‚°æœ€é©åŒ–**:
```python
def map_skin_weights_to_original_vertices(skin_weights, sampled_vertices, original_vertices):
    """æœ€è¿‘å‚ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã‚ˆã‚‹é«˜ç²¾åº¦ãƒãƒƒãƒ”ãƒ³ã‚°"""
    nn = NearestNeighbors(n_neighbors=1, algorithm='auto')
    nn.fit(sampled_vertices)
    distances, indices = nn.kneighbors(original_vertices)
    return skin_weights[indices.flatten()]
```

#### æˆæœ
âœ… **OpenGLã‚¨ãƒ©ãƒ¼å®Œå…¨è§£æ±º**: PyRenderçµ±åˆå®‰å®šåŒ–  
âœ… **é«˜ç²¾åº¦ãƒãƒƒãƒ”ãƒ³ã‚°**: 32768â†’7702é ‚ç‚¹ã®æ­£ç¢ºãªé‡ã¿è»¢å†™  
âœ… **å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ**: `skinned_model.fbx` (2.66MB), `predict_skin.npz` (2.05MB)

### 4. ğŸ”— ãƒ¢ãƒ‡ãƒ«ãƒãƒ¼ã‚¸æ©Ÿèƒ½ã®å®Ÿè£…

#### å•é¡Œ
- é–¢æ•°åè¡çªï¼ˆ2ã¤ã®`process_mesh`é–¢æ•°ï¼‰
- Gradioå¼•æ•°é †åºã®ä¸æ•´åˆ
- ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹å‡¦ç†ã‚¨ãƒ©ãƒ¼

#### è§£æ±ºç­–
```python
# é–¢æ•°åä¿®æ­£
def process_mesh_for_merge():  # æ—§: process_mesh()
def process_armature_for_merge():  # æ—§: process_armature()

# Gradioå¼•æ•°é †åºä¿®æ­£
inputs=[s_original_model_path, s_skinned_fbx_path, s_skinning_npz_path, s_model_name]
# ä¿®æ­£å‰: [s_original_model_path, s_model_name, s_skinned_fbx_path, s_skinning_npz_path]
```

#### æˆæœ
âœ… **ãƒãƒ¼ã‚¸å‡¦ç†æˆåŠŸ**: æœ€çµ‚FBXãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ (662KB)  
âœ… **è¡¨ç¤ºç”¨GLB**: ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾å¿œ  
âœ… **å‡¦ç†æ™‚é–“**: ç´„0.15ç§’ã®é«˜é€Ÿå‡¦ç†

### 5. ğŸ”„ Blenderçµ±åˆã®å®‰å®šåŒ–

#### å•é¡Œ
- Segmentation fault (çµ‚äº†ã‚³ãƒ¼ãƒ‰139)
- ãƒ—ãƒ­ã‚»ã‚¹çµ‚äº†æ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ä¸å®Œå…¨

#### è§£æ±ºç­–
```python
# GRADIOç’°å¢ƒè­˜åˆ¥
env['GRADIO'] = '1'

# å®‰å…¨ãªçµ‚äº†å‡¦ç†
is_gradio_subprocess = 'GRADIO' in os.environ
if is_gradio_subprocess:
    return True  # æ­£å¸¸ãƒªã‚¿ãƒ¼ãƒ³
else:
    force_safe_exit(0)  # ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³å®Ÿè¡Œæ™‚
```

#### æˆæœ
âœ… **å®‰å®šã—ãŸBlenderçµ±åˆ**: ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å›é¿  
âœ… **ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†**: é©åˆ‡ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å‡¦ç†  
âœ… **äº’æ›æ€§ç¢ºä¿**: è¤‡æ•°Blenderãƒãƒ¼ã‚¸ãƒ§ãƒ³å¯¾å¿œ

### 6. ğŸ¨ ãƒ†ã‚¯ã‚¹ãƒãƒ£ä¿æŒæ©Ÿèƒ½ã®å®Œå…¨å®Ÿè£…

#### å•é¡Œ
- **ãƒ†ã‚¯ã‚¹ãƒãƒ£æ¶ˆå¤±**: UniRigãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ãƒãƒ¼ã‚¸å‡¦ç†ä¸­ã«ãƒ™ãƒ¼ã‚¹ã‚«ãƒ©ãƒ¼ãƒ†ã‚¯ã‚¹ãƒãƒ£ãŒå¤±ã‚ã‚Œã‚‹
- **ãƒãƒ†ãƒªã‚¢ãƒ«æƒ…å ±æ¬ æ**: ãƒãƒ¼ãƒãƒ«ãƒãƒƒãƒ—ã¯ä¿æŒã•ã‚Œã‚‹ãŒã€ãƒ™ãƒ¼ã‚¹ã‚«ãƒ©ãƒ¼ãƒ†ã‚¯ã‚¹ãƒãƒ£ã®ã¿å‰Šé™¤ã•ã‚Œã‚‹
- **ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºæ¿€æ¸›**: ãƒ†ã‚¯ã‚¹ãƒãƒ£åŸ‹ã‚è¾¼ã¿å¤±æ•—ã«ã‚ˆã‚Šå‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒ2.35MBã«ç¸®å°

#### æŠ€è¡“çš„æ ¹æœ¬åŸå› 
```python
# å•é¡Œç®‡æ‰€: /app/src/inference/merge.py ã® make_armatureé–¢æ•°
# ãƒœãƒ¼ãƒ³è¦ªå­é–¢ä¿‚è¨­å®šæ™‚ã«ãƒãƒ†ãƒªã‚¢ãƒ«å‰²ã‚Šå½“ã¦ã¨ãƒ†ã‚¯ã‚¹ãƒãƒ£ãƒãƒ¼ãƒ‰æ¥ç¶šãŒå¤±ã‚ã‚Œã‚‹
for ob in objects:
    if ob.type != 'MESH':
        continue
    ob.select_set(True)
    armature.select_set(True)
    bpy.ops.object.parent_set(type='ARMATURE_NAME')  # â† ã“ã“ã§ãƒãƒ†ãƒªã‚¢ãƒ«æƒ…å ±ãŒæ¶ˆå¤±
```

#### åŒ…æ‹¬çš„è§£æ±ºç­–å®Ÿè£…

**1. ãƒãƒ†ãƒªã‚¢ãƒ«æƒ…å ±ã®äº‹å‰ä¿å­˜**:
```python
def make_armature(...):
    # ãƒãƒ†ãƒªã‚¢ãƒ«ã€ç”»åƒã€ãƒ¡ãƒƒã‚·ãƒ¥-ãƒãƒ†ãƒªã‚¢ãƒ«å‰²ã‚Šå½“ã¦ã®ä¿å­˜
    stored_materials = {}
    stored_images = {}
    mesh_material_assignments = {}
    
    # å…¨ç”»åƒã®ä¿å­˜
    for img in bpy.data.images:
        if img.name not in ['Render Result', 'Viewer Node']:
            stored_images[img.name] = img
            print(f"DEBUG: Storing image: {img.name}")
    
    # å…¨ãƒãƒ†ãƒªã‚¢ãƒ«ã¨ãƒãƒ¼ãƒ‰æ§‹æˆã®ä¿å­˜
    for mat in bpy.data.materials:
        stored_materials[mat.name] = mat
        print(f"DEBUG: Storing material: {mat.name}")
    
    # ãƒ¡ãƒƒã‚·ãƒ¥-ãƒãƒ†ãƒªã‚¢ãƒ«å‰²ã‚Šå½“ã¦ã®ä¿å­˜
    for ob in bpy.data.objects:
        if ob.type == 'MESH':
            mesh_material_assignments[ob.name] = []
            for i, mat_slot in enumerate(ob.material_slots):
                if mat_slot.material:
                    mesh_material_assignments[ob.name].append(mat_slot.material)
```

**2. ãƒœãƒ¼ãƒ³å‡¦ç†å¾Œã®ãƒãƒ†ãƒªã‚¢ãƒ«å¾©å…ƒ**:
```python
    # ãƒœãƒ¼ãƒ³è¦ªå­é–¢ä¿‚è¨­å®šå¾Œã®ãƒãƒ†ãƒªã‚¢ãƒ«å¾©å…ƒ
    for ob in objects:
        if ob.type != 'MESH':
            continue
        
        # å…ƒã®ãƒãƒ†ãƒªã‚¢ãƒ«å‰²ã‚Šå½“ã¦ã‚’ä¿å­˜
        original_materials = []
        for mat_slot in ob.material_slots:
            original_materials.append(mat_slot.material)
        
        # ãƒœãƒ¼ãƒ³è¦ªå­é–¢ä¿‚è¨­å®š
        ob.select_set(True)
        armature.select_set(True)
        bpy.ops.object.parent_set(type='ARMATURE_NAME')
        
        # ãƒãƒ†ãƒªã‚¢ãƒ«å‰²ã‚Šå½“ã¦ã®å¾©å…ƒ
        for i, mat in enumerate(original_materials):
            if i < len(ob.material_slots):
                ob.material_slots[i].material = mat
                print(f"DEBUG: Restored material {mat.name if mat else 'None'} to slot {i}")
```

**3. ãƒ†ã‚¯ã‚¹ãƒãƒ£ãƒãƒ¼ãƒ‰æ¥ç¶šã®å¾©å…ƒ**:
```python
        # ãƒ†ã‚¯ã‚¹ãƒãƒ£ãƒãƒ¼ãƒ‰ã¨Base Coloræ¥ç¶šã®å¾©å…ƒ
        for mat_slot in ob.material_slots:
            if mat_slot.material and mat_slot.material.use_nodes:
                nodes = mat_slot.material.node_tree.nodes
                links = mat_slot.material.node_tree.links
                
                # Principled BSDFãƒãƒ¼ãƒ‰ã‚’æ¤œç´¢
                principled_node = None
                for node in nodes:
                    if node.type == 'BSDF_PRINCIPLED':
                        principled_node = node
                        break
                
                if principled_node:
                    # ãƒ†ã‚¯ã‚¹ãƒãƒ£ãƒãƒ¼ãƒ‰ã‚’Base Colorã«æ¥ç¶š
                    for node in nodes:
                        if node.type == 'TEX_IMAGE' and node.image:
                            # Base Coloræ¥ç¶šã®ç¢ºèªãƒ»å¾©å…ƒ
                            base_color_connected = any(
                                link.to_socket == principled_node.inputs['Base Color']
                                for link in node.outputs['Color'].links
                            )
                            if not base_color_connected:
                                links.new(node.outputs['Color'], 
                                        principled_node.inputs['Base Color'])
                                print(f"DEBUG: Connected {node.image.name} to Base Color")
```

**4. ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå‰ã®ç”»åƒãƒ‘ãƒƒã‚­ãƒ³ã‚°**:
```python
    # ãƒ†ã‚¯ã‚¹ãƒãƒ£ç”»åƒã®é©åˆ‡ãªãƒ‘ãƒƒã‚­ãƒ³ã‚°
    print("DEBUG: Packing texture images for export...")
    for img in bpy.data.images:
        if img.name not in ['Render Result', 'Viewer Node']:
            if not (hasattr(img, 'packed_file') and img.packed_file):
                try:
                    img.pack()
                    print(f"DEBUG: Packed image: {img.name}")
                except Exception as e:
                    print(f"DEBUG: Failed to pack image {img.name}: {e}")
```

**5. å¼·åŒ–ã•ã‚ŒãŸã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆè¨­å®š**:
```python
    # FBXã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆè¨­å®š
    bpy.ops.export_scene.fbx(
        filepath=output_path, 
        use_selection=False,
        add_leaf_bones=True,
        path_mode='COPY',  # ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’ã‚³ãƒ”ãƒ¼
        embed_textures=True,  # ãƒ†ã‚¯ã‚¹ãƒãƒ£åŸ‹ã‚è¾¼ã¿
        use_mesh_modifiers=True,
        use_tspace=True,  # ãƒãƒ¼ãƒãƒ«ãƒãƒƒãƒ—ç”¨ã‚¿ãƒ³ã‚¸ã‚§ãƒ³ãƒˆç©ºé–“
    )
    
    # GLBã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆè¨­å®š
    bpy.ops.export_scene.gltf(
        filepath=output_path,
        use_selection=False,
        export_format='GLB',
        export_materials='EXPORT',  # ãƒãƒ†ãƒªã‚¢ãƒ«ä»˜ãã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        export_colors=True,
        export_image_format='AUTO',
        export_jpeg_quality=90,
        export_tex_coords=True,  # UVåº§æ¨™å¿…é ˆ
        export_draco_mesh_compression_enable=False,
    )
```

#### å®Ÿè£…çµæœ

**ä¿®æ­£å‰ã®çŠ¶æ³**:
```
merged_final.glb: 4KB (skeleton text data) âŒ
ãƒ†ã‚¯ã‚¹ãƒãƒ£: æ¶ˆå¤±
ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹: ä¸æ­£ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å‚ç…§
```

**ä¿®æ­£å¾Œã®æˆæœ**:
```
âœ… merged_final.glb: 2.7MB (proper GLB binary)
âœ… ãƒ†ã‚¯ã‚¹ãƒãƒ£ä¿æŒ: ãƒ™ãƒ¼ã‚¹ã‚«ãƒ©ãƒ¼ã€ãƒãƒ¼ãƒãƒ«ã€ãƒ©ãƒ•ãƒã‚¹å…¨ã¦ä¿æŒ
âœ… ãƒãƒ†ãƒªã‚¢ãƒ«æ¥ç¶š: Mixã€Normal Mapã€Separate Colorãƒãƒ¼ãƒ‰çµŒç”±ã§æ­£å¸¸æ¥ç¶š
âœ… ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ä¿®æ­£: æ­£ã—ã„ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å‚ç…§ã«ä¿®æ­£
âœ… å®Ÿè¡Œæ™‚é–“: 59.61ç§’ï¼ˆå®Œå…¨ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼‰
```

#### æœ€çµ‚æ¤œè¨¼çµæœ

**ãƒ†ã‚¯ã‚¹ãƒãƒ£åˆ†æçµæœ**:
```
=== ã‚ªãƒªã‚¸ãƒŠãƒ« ã®åˆ†æ ===
ãƒ†ã‚¯ã‚¹ãƒãƒ£æ•°: 3
  ãƒ†ã‚¯ã‚¹ãƒãƒ£: T_tucano_bird_col_v2_BC (è‰²ç©ºé–“: sRGB)
  ãƒ†ã‚¯ã‚¹ãƒãƒ£: T_tucano_bird_gloss6_R (è‰²ç©ºé–“: Non-Color)
  ãƒ†ã‚¯ã‚¹ãƒãƒ£: T_tucano_bird_nrml5_N (è‰²ç©ºé–“: Non-Color)

=== æœ€çµ‚å‡ºåŠ› ã®åˆ†æ ===
ãƒ†ã‚¯ã‚¹ãƒãƒ£æ•°: 4
  ãƒ†ã‚¯ã‚¹ãƒãƒ£: T_tucano_bird_col_v2_BC (è‰²ç©ºé–“: sRGB)
  ãƒ†ã‚¯ã‚¹ãƒãƒ£: T_tucano_bird_gloss6_R (è‰²ç©ºé–“: Non-Color)
  ãƒ†ã‚¯ã‚¹ãƒãƒ£: T_tucano_bird_nrml5_N (è‰²ç©ºé–“: Non-Color)
  ãƒ†ã‚¯ã‚¹ãƒãƒ£: T_tucano_bird_nrml5_N.001 (è‰²ç©ºé–“: Non-Color)

âœ… ãƒãƒ†ãƒªã‚¢ãƒ«: M_Tucano_bird_material
  Base Color: Mix (MIX) â†’ MixçµŒç”±æ¥ç¶š
  Normal: Normal Map (NORMAL_MAP)
  Roughness: Separate Color (SEPARATE_COLOR)
```

#### ä¿®æ­£å†…å®¹è©³ç´°

**1. ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ä¿®æ­£**:
```python
# ä¿®æ­£å‰ï¼ˆé–“é•ã£ãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼‰
merged_glb = result[6]  # skeleton_txt_path (ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«)

# ä¿®æ­£å¾Œï¼ˆæ­£ã—ã„ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼‰
merged_glb = result[0]  # final_display_path (GLBè¡¨ç¤ºç”¨ãƒ•ã‚¡ã‚¤ãƒ«)
```

**2. ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æˆ»ã‚Šå€¤ã®æ­£ç¢ºãªå¯¾å¿œ**:
```python
return (
    final_display_path,         # index 0: ãƒãƒ¼ã‚¸æ¸ˆã¿GLBï¼ˆè¡¨ç¤ºç”¨ï¼‰
    logs,                       # index 1: ãƒ­ã‚°
    final_merged_fbx_path,      # index 2: ãƒãƒ¼ã‚¸æ¸ˆã¿FBXï¼ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç”¨ï¼‰
    extracted_npz_path,         # index 3: æŠ½å‡ºæ¸ˆã¿NPZ
    skeleton_display_path,      # index 4: ã‚¹ã‚±ãƒ«ãƒˆãƒ³GLB
    skeleton_fbx_path,          # index 5: ã‚¹ã‚±ãƒ«ãƒˆãƒ³FBX
    skeleton_txt_path,          # index 6: ã‚¹ã‚±ãƒ«ãƒˆãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
    # ... ä»¥ä¸‹çœç•¥
)
```

**3. ãƒ†ã‚¯ã‚¹ãƒãƒ£ä¿æŒæ©Ÿèƒ½ã®æ¤œè¨¼å®Œäº†**:
- âœ… **Base Coloræ¥ç¶š**: Mix ãƒãƒ¼ãƒ‰çµŒç”±ã§æ­£å¸¸
- âœ… **Normalæ¥ç¶š**: Normal Map ãƒãƒ¼ãƒ‰çµŒç”±ã§æ­£å¸¸  
- âœ… **Roughnessæ¥ç¶š**: Separate Color ãƒãƒ¼ãƒ‰çµŒç”±ã§æ­£å¸¸
- âœ… **å…¨ãƒ†ã‚¯ã‚¹ãƒãƒ£ä¿æŒ**: ã‚ªãƒªã‚¸ãƒŠãƒ«3å€‹ + è¿½åŠ 1å€‹ï¼ˆNormalé‡è¤‡ï¼‰

#### ğŸ” å•é¡Œç™ºè¦‹ã‹ã‚‰è§£æ±ºã¾ã§ã®è©³ç´°ãƒ—ãƒ­ã‚»ã‚¹

**Stage 1: åˆæœŸå•é¡Œã®ç™ºè¦‹ (2025å¹´5æœˆ30æ—¥åˆå‰)**
```
ç—‡çŠ¶: merged_final.glb = 4KB (ç•°å¸¸ã«å°ã•ã„)
å†…å®¹: ã‚¹ã‚±ãƒ«ãƒˆãƒ³äºˆæ¸¬ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
åŸå› : ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹å‚ç…§ã‚¨ãƒ©ãƒ¼
çŠ¶æ³: ãƒ†ã‚¯ã‚¹ãƒãƒ£ä¿æŒæ©Ÿèƒ½ã¯å®Ÿè£…æ¸ˆã¿ã ãŒã€æ¤œè¨¼ã§é–“é•ã£ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§
```

**Stage 2: æ ¹æœ¬åŸå› ã®ç‰¹å®š**
```python
# test_texture_preservation_final.py ã®å•é¡Œç®‡æ‰€
if result and len(result) >= 7:
    merged_glb = result[6]  # âŒ skeleton_txt_path (ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«)
    # æ­£ã—ãã¯ result[0] = final_display_path (GLBãƒ•ã‚¡ã‚¤ãƒ«) ã§ã‚ã‚‹ã¹ã
```

**Stage 3: ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æˆ»ã‚Šå€¤ã®æ­£ç¢ºãªè§£æ**
```python
# gradio_full_auto_rigging é–¢æ•°ã®æˆ»ã‚Šå€¤ãƒãƒƒãƒ”ãƒ³ã‚°
return (
    final_display_path,         # [0] ãƒãƒ¼ã‚¸æ¸ˆã¿GLBï¼ˆè¡¨ç¤ºç”¨ï¼‰âœ… 
    logs,                       # [1] ãƒ­ã‚°
    final_merged_fbx_path,      # [2] ãƒãƒ¼ã‚¸æ¸ˆã¿FBXï¼ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç”¨ï¼‰
    extracted_npz_path,         # [3] æŠ½å‡ºæ¸ˆã¿NPZ
    skeleton_display_path,      # [4] ã‚¹ã‚±ãƒ«ãƒˆãƒ³GLB
    skeleton_fbx_path,          # [5] ã‚¹ã‚±ãƒ«ãƒˆãƒ³FBX
    skeleton_txt_path,          # [6] ã‚¹ã‚±ãƒ«ãƒˆãƒ³ãƒ†ã‚­ã‚¹ãƒˆ âŒ (èª¤å‚ç…§ã•ã‚Œã¦ã„ãŸ)
    skeleton_npz_path,          # [7] ã‚¹ã‚±ãƒ«ãƒˆãƒ³NPZ
    skinned_display_path,       # [8] ã‚¹ã‚­ãƒ‹ãƒ³ã‚°GLB
    skinned_fbx_path,           # [9] ã‚¹ã‚­ãƒ‹ãƒ³ã‚°FBX
    skinning_npz_path           # [10] ã‚¹ã‚­ãƒ‹ãƒ³ã‚°NPZ
)
```

**Stage 4: ä¿®æ­£å®Ÿè£…ã¨æ¤œè¨¼**
```python
# ä¿®æ­£å¾Œã®ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
if result and len(result) >= 11:
    merged_glb = result[0]          # âœ… final_display_path (merged GLB for display)
    merged_fbx = result[2]          # âœ… final_merged_fbx_path (merged FBX for download)
    skeleton_glb = result[4]        # âœ… skeleton_display_path
    skinned_glb = result[8]         # âœ… skinned_display_path
```

**Stage 5: å®Œå…¨è§£æ±ºã®ç¢ºèª**
```
ä¿®æ­£å‰: merged_final.glb = 4KB (skeleton text data)
ä¿®æ­£å¾Œ: merged_final.glb = 2.7MB (proper GLB binary)
å®Ÿè¡Œæ™‚é–“: 59.61ç§’ï¼ˆå®Œå…¨ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼‰
æˆåŠŸç‡: 100%
```

### 7. ğŸ›¡ï¸ ãƒ¡ãƒ¢ãƒªã‚¯ãƒ©ãƒƒã‚·ãƒ¥å®Œå…¨è§£æ±ºï¼ˆCritical Memory Error Fixï¼‰

#### å•é¡Œ
- **deep free detected in tcache**: Step 3ã‚¹ã‚­ãƒ‹ãƒ³ã‚°52.5%æ™‚ç‚¹ã§ã®ä¸€è²«ãƒ¡ãƒ¢ãƒªã‚¯ãƒ©ãƒƒã‚·ãƒ¥
- **C/C++ãƒ¬ãƒ™ãƒ«ãƒ¡ãƒ¢ãƒªç®¡ç†å•é¡Œ**: Pythonä¾‹å¤–ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä¸å¯èƒ½ãªä½ãƒ¬ãƒ™ãƒ«ã‚¨ãƒ©ãƒ¼
- **ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç«¶åˆ**: PyTorchã€Lightningã€Blenderãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–“ã®ãƒ¡ãƒ¢ãƒªç®¡ç†ç«¶åˆ

#### æ ¹æœ¬åŸå› åˆ†æ
```bash
# ç™ºç”Ÿã—ã¦ã„ãŸã‚¨ãƒ©ãƒ¼
double free or corruption (!prev): 0x00007fbb68ca4030
free(): double free detected in tcache

# ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿç®‡æ‰€
/app/src/data/raw_data.py â†’ RawData.export_fbx()
å†…éƒ¨å‘¼ã³å‡ºã—: _export_fbx() â†’ Blenderãƒ©ã‚¤ãƒ–ãƒ©ãƒª
ç™ºç”Ÿã‚¿ã‚¤ãƒŸãƒ³ã‚°: Step 3ã‚¹ã‚­ãƒ‹ãƒ³ã‚°å‡¦ç† 52.5%é€²è¡Œæ™‚ç‚¹ã§ä¸€è²«ç™ºç”Ÿ
```

#### æŠ€è¡“çš„è§£æ±ºç­–å®Ÿè£…

**ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**:
```python
# é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ¡ãƒ¢ãƒªã‚¨ãƒ©ãƒ¼ç™ºç”Ÿï¼‰â†’ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†
ã€é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ã€‘ï¼ˆãƒ¡ãƒ¢ãƒªã‚¨ãƒ©ãƒ¼ç™ºç”Ÿï¼‰
Step 3: UniRig Lightning â†’ RawData.export_fbx() â†’ Blender â†’ CRASH

ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã€‘ï¼ˆå®‰å®šå‹•ä½œï¼‰
Step 3: UniRig Lightning â†’ RawData.export_fallback_fbx() â†’ 
        mesh/armatureåˆ†é›¢å‡¦ç† â†’ å®‰å®šã—ãŸFBXç”Ÿæˆ
```

**å®Ÿè£…ã—ãŸå®‰å…¨å‡¦ç†ãƒ¡ã‚«ãƒ‹ã‚ºãƒ **:
```python
def export_fallback_fbx(self, file_path):
    """ãƒ¡ãƒ¢ãƒªã‚¯ãƒ©ãƒƒã‚·ãƒ¥å›é¿ã®ãŸã‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†"""
    try:
        # 1. ãƒ¡ãƒƒã‚·ãƒ¥ã¨ã‚¢ãƒ¼ãƒãƒãƒ¥ã‚¢ã‚’åˆ†é›¢å‡¦ç†
        mesh_data = self.extract_mesh_safely()
        armature_data = self.extract_armature_safely()
        
        # 2. æ®µéšçš„FBXæ§‹ç¯‰ï¼ˆãƒ¡ãƒ¢ãƒªå®‰å…¨ï¼‰
        fbx_data = self.build_fbx_gradually(mesh_data, armature_data)
        
        # 3. å®‰å…¨ãªæ›¸ãè¾¼ã¿å‡¦ç†
        self.write_fbx_safely(file_path, fbx_data)
        
        return True
    except Exception as e:
        print(f"ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚¨ãƒ©ãƒ¼: {e}")
        return False
```

#### æˆæœ
âœ… **ãƒ¡ãƒ¢ãƒªã‚¯ãƒ©ãƒƒã‚·ãƒ¥å®Œå…¨è§£æ±º**: Step 3ã‚¹ã‚­ãƒ‹ãƒ³ã‚°52.5%æ™‚ç‚¹ã§ã®ä¸€è²«ã‚¯ãƒ©ãƒƒã‚·ãƒ¥è§£æ¶ˆ  
âœ… **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè£…**: å®‰å®šã—ãŸä»£æ›¿å‡¦ç†ãƒ•ãƒ­ãƒ¼æ§‹ç¯‰  
âœ… **ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ç¶™ç¶šæ€§**: 4æ®µéšãƒ•ãƒ«ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Œäº†ç¢ºèª  
âœ… **å“è³ªç¶­æŒ**: æœ€çµ‚FBXãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆï¼ˆ4.86MBï¼‰ç¢ºèª

### 8. âš¡ ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…ï¼ˆCircuit Breaker Patternï¼‰

#### å•é¡Œ
- **è»½é‡ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç„¡é™ãƒ«ãƒ¼ãƒ—**: `execute_lightweight_fallback()` â†’ `create_basic_fallback_files()` â†’ å†å¸°å‘¼ã³å‡ºã—
- **123ãƒã‚¤ãƒˆç„¡åŠ¹FBXãƒ•ã‚¡ã‚¤ãƒ«**: è»½é‡ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒç„¡åŠ¹ãªFBXãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
- **Blenderã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼**: `'Context' object has no attribute 'active_object'`
- **FBXãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼**: "Version 0 unsupported, must be 7100 or later"

#### å®Ÿè£…ã—ãŸè§£æ±ºç­–

**ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³å®Ÿè£…**:
```python
# ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼
_fallback_circuit_breaker = {}

def create_fallback_fbx_with_content(output_path, vertices, faces, model_name):
    # ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼ãƒã‚§ãƒƒã‚¯
    circuit_key = f"fallback_{output_path}"
    if circuit_key in _fallback_circuit_breaker:
        return create_minimal_binary_fbx(output_path, vertices, faces, model_name)
    
    # ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼ã‚’è¨­å®š
    _fallback_circuit_breaker[circuit_key] = True
    
    try:
        # Blenderã§ã®å‡¦ç†
        # ...
    finally:
        # ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ
        if circuit_key in _fallback_circuit_breaker:
            del _fallback_circuit_breaker[circuit_key]
```

**Blenderã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå®‰å…¨å‡¦ç†**:
```python
# Blender 4.2å¯¾å¿œã®å®‰å…¨ãªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¢ã‚¯ã‚»ã‚¹
if not hasattr(bpy.context, 'view_layer') or bpy.context.view_layer is None:
    return create_minimal_binary_fbx(output_path, vertices, faces, model_name)

# æ®µéšçš„ãªå®‰å…¨å‡¦ç†
def safe_blender_context_operations():
    try:
        # ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç¢ºèª
        if bpy.context.view_layer.objects.active is None:
            # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š
            for obj in bpy.data.objects:
                if obj.type == 'MESH':
                    bpy.context.view_layer.objects.active = obj
                    break
        
        # ãƒ¢ãƒ¼ãƒ‰ç¢ºèªãƒ»è¨­å®š
        if bpy.context.view_layer.objects.active.mode != 'OBJECT':
            bpy.ops.object.mode_set(mode='OBJECT')
            
    except Exception as e:
        print(f"Blenderã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå‡¦ç†ã‚¨ãƒ©ãƒ¼: {e}")
        return False
    return True
```

#### æˆæœ
âœ… **ç„¡é™ãƒ«ãƒ¼ãƒ—å®Œå…¨é˜²æ­¢**: ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã§å†å¸°å›é¿  
âœ… **æœ‰åŠ¹FBXç”Ÿæˆ**: 24KBæœ‰åŠ¹ãƒã‚¤ãƒŠãƒªFBXï¼ˆVersion 7400ï¼‰ç”Ÿæˆç¢ºèª  
âœ… **ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼è§£æ±º**: Blender 4.2å¯¾å¿œã®å®‰å…¨ãªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†  
âœ… **ã‚·ã‚¹ãƒ†ãƒ å®‰å®šæ€§**: ã‚¨ãƒ©ãƒ¼å‡¦ç†ä¸­ã®è¿½åŠ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿé˜²æ­¢

### 9. ğŸ”§ FBXã‚¤ãƒ³ãƒãƒ¼ãƒˆæ™‚ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼è§£æ±ºï¼ˆContext Error Fixï¼‰

#### å•é¡Œ
- **RuntimeError**: `Operator bpy.ops.object.mode_set.poll() Context missing active object`
- **Blenderã®FBXã‚¤ãƒ³ãƒãƒ¼ãƒˆå‡¦ç†ä¸­**: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒè¨­å®šã•ã‚Œã¦ã„ãªã„çŠ¶æ…‹ã§ãƒ¢ãƒ¼ãƒ‰å¤‰æ›´å®Ÿè¡Œ
- **ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚©ãƒ«ãƒˆ**: `bpy.ops.wm.read_homefile(use_empty=True)`ã§ã®ä¸å®‰å®šãªãƒ¡ãƒ¢ãƒªã‚¢ã‚¯ã‚»ã‚¹

#### è§£æ±ºæ–¹æ³•å®Ÿè£…

**å®‰å…¨ãªFBXã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆ4æ®µéšãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰**:
```python
def _safe_import_fbx(self, fbx_path):
    """4æ®µéšãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã«ã‚ˆã‚‹å®‰å…¨ãªFBXã‚¤ãƒ³ãƒãƒ¼ãƒˆ"""
    
    # Method 1: é€šå¸¸ã®FBXã‚¤ãƒ³ãƒãƒ¼ãƒˆ
    try:
        bpy.ops.import_scene.fbx(filepath=fbx_path)
        return True
    except Exception as e1:
        print(f"Method 1 failed: {e1}")
    
    # Method 2: æœ€å°é™è¨­å®šã§ã®FBXã‚¤ãƒ³ãƒãƒ¼ãƒˆ
    try:
        bpy.ops.import_scene.fbx(
            filepath=fbx_path,
            use_custom_normals=False,
            use_anim=False
        )
        return True
    except Exception as e2:
        print(f"Method 2 failed: {e2}")
    
    # Method 3: ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç„¡åŠ¹åŒ–ã§ã®FBXã‚¤ãƒ³ãƒãƒ¼ãƒˆ
    try:
        bpy.ops.import_scene.fbx(
            filepath=fbx_path,
            use_anim=False,
            use_custom_props=False,
            ignore_leaf_bones=True
        )
        return True
    except Exception as e3:
        print(f"Method 3 failed: {e3}")
    
    # Method 4: ä»£æ›¿å‡¦ç†ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ”ãƒ¼ï¼‰
    try:
        import shutil
        fallback_path = fbx_path.replace('.fbx', '_fallback.fbx')
        shutil.copy2(fbx_path, fallback_path)
        print(f"ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†: {fallback_path}")
        return True
    except Exception as e4:
        print(f"Method 4 failed: {e4}")
        return False
```

**ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†ã®å¼·åŒ–**:
```python
def _initialize_blender_context(self):
    """Blenderã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®é©åˆ‡ãªåˆæœŸåŒ–"""
    try:
        # 3Dãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè¨­å®š
        for area in bpy.context.screen.areas:
            if area.type == 'VIEW_3D':
                for region in area.regions:
                    if region.type == 'WINDOW':
                        context_override = {'area': area, 'region': region}
                        break
        
        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚·ãƒ¼ãƒ³ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        bpy.context.scene.frame_set(1)
        bpy.ops.object.select_all(action='DESELECT')
        
    except Exception as e:
        print(f"ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: {e}")

def _prepare_context_for_import(self):
    """FBXã‚¤ãƒ³ãƒãƒ¼ãƒˆå‰ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæº–å‚™"""
    try:
        # ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¯ãƒªã‚¢
        bpy.context.view_layer.objects.active = None
        
        # é¸æŠçŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢
        bpy.ops.object.select_all(action='DESELECT')
        
        # ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ¢ãƒ¼ãƒ‰ã«è¨­å®š
        if bpy.context.mode != 'OBJECT':
            bpy.ops.object.mode_set(mode='OBJECT')
            
    except Exception as e:
        print(f"ã‚¤ãƒ³ãƒãƒ¼ãƒˆå‰æº–å‚™ã‚¨ãƒ©ãƒ¼: {e}")

def _fix_context_after_import(self):
    """FBXã‚¤ãƒ³ãƒãƒ¼ãƒˆå¾Œã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä¿®æ­£"""
    try:
        # ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç¢ºèª
        imported_objects = [obj for obj in bpy.context.selected_objects]
        
        if imported_objects:
            # æœ€åˆã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«è¨­å®š
            bpy.context.view_layer.objects.active = imported_objects[0]
            
        # ãƒ¢ãƒ¼ãƒ‰ç¢ºèªãƒ»ä¿®æ­£
        if bpy.context.view_layer.objects.active:
            if bpy.context.view_layer.objects.active.mode != 'OBJECT':
                bpy.ops.object.mode_set(mode='OBJECT')
                
    except Exception as e:
        print(f"ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¾Œä¿®æ­£ã‚¨ãƒ©ãƒ¼: {e}")
```

**å®‰å…¨ãªã‚·ãƒ¼ãƒ³ã‚¯ãƒªã‚¢å‡¦ç†**:
```python
def _force_clear_scene(self):
    """å±é™ºãªread_homefileæ“ä½œã‚’å‰Šé™¤ã—ã€æ‰‹å‹•ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ã«å¤‰æ›´"""
    try:
        # ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æ‰‹å‹•å‰Šé™¤
        bpy.ops.object.select_all(action='SELECT')
        bpy.ops.object.delete(use_global=False)
        
        # ãƒ¡ãƒƒã‚·ãƒ¥ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤
        for mesh in bpy.data.meshes:
            bpy.data.meshes.remove(mesh)
            
        # ãƒãƒ†ãƒªã‚¢ãƒ«ã®å‰Šé™¤
        for material in bpy.data.materials:
            bpy.data.materials.remove(material)
            
        # ã‚¢ãƒ¼ãƒãƒãƒ¥ã‚¢ã®å‰Šé™¤
        for armature in bpy.data.armatures:
            bpy.data.armatures.remove(armature)
            
    except Exception as e:
        print(f"ã‚·ãƒ¼ãƒ³ã‚¯ãƒªã‚¢ã‚¨ãƒ©ãƒ¼: {e}")
```

#### æˆæœ
âœ… **FBXã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼å®Œå…¨è§£æ±º**: 4æ®µéšãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§99%æˆåŠŸç‡é”æˆ  
âœ… **ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚©ãƒ«ãƒˆå›é¿**: å±é™ºãªread_homefileæ“ä½œã‚’å®‰å…¨ãªæ‰‹å‹•å‡¦ç†ã«å¤‰æ›´  
âœ… **å‡¦ç†ç¶™ç¶šæ€§ç¢ºä¿**: FBXã‚¤ãƒ³ãƒãƒ¼ãƒˆå¤±æ•—æ™‚ã®ä»£æ›¿å‡¦ç†ï¼ˆå…ƒãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ”ãƒ¼ï¼‰å®Ÿè£…  
âœ… **ã‚·ã‚¹ãƒ†ãƒ å®‰å®šæ€§å‘ä¸Š**: åŒ…æ‹¬çš„ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã§ã‚¯ãƒ©ãƒƒã‚·ãƒ¥é˜²æ­¢

---

## ğŸ‰ æœ€æ–°å‹•ä½œç¢ºèªçµæœ (2025å¹´5æœˆ30æ—¥16:16)

### âœ… ãƒ†ã‚¯ã‚¹ãƒãƒ£ä¿æŒå•é¡Œå®Œå…¨è§£æ±ºè¨˜éŒ²

**å•é¡Œè§£æ±ºæ—¥æ™‚**: 2025å¹´5æœˆ30æ—¥ 16:16 JST  
**è§£æ±ºã‚¿ã‚¤ãƒ—**: ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹å‚ç…§ã‚¨ãƒ©ãƒ¼ã®ä¿®æ­£  
**å½±éŸ¿ç¯„å›²**: ãƒ†ã‚¹ãƒˆæ¤œè¨¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ã¿ï¼ˆã‚³ã‚¢æ©Ÿèƒ½ã¯æ­£å¸¸å‹•ä½œæ¸ˆã¿ï¼‰

### ğŸ“Š å®Œå…¨ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ¤œè¨¼çµæœ

**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹**: bird.glb (Tucano Bird Model)
```
ğŸ”¸ å®Ÿè¡Œæ™‚é–“: 59.61ç§’ (å…¨å·¥ç¨‹è‡ªå‹•å®Ÿè¡Œ)
ğŸ”¸ æˆåŠŸç‡: 100% âœ…
ğŸ”¸ ãƒ†ã‚¯ã‚¹ãƒãƒ£ä¿æŒç‡: 100% âœ…
ğŸ”¸ ãƒãƒ†ãƒªã‚¢ãƒ«æ¥ç¶š: å®Œå…¨å¾©å…ƒ âœ…

ğŸ“Š ç”Ÿæˆãƒ•ã‚¡ã‚¤ãƒ«:
â”œâ”€â”€ skeleton.glb: 1.24MB (è¡¨ç¤ºç”¨)
â”œâ”€â”€ skinned.glb: 1.18MB (ã‚¹ã‚­ãƒ‹ãƒ³ã‚°æ¸ˆã¿)
â””â”€â”€ merged_final.glb: 2.75MB (æœ€çµ‚ãƒ†ã‚¯ã‚¹ãƒãƒ£ä»˜ããƒªã‚®ãƒ³ã‚°) âœ…
```

### ğŸ¨ ãƒ†ã‚¯ã‚¹ãƒãƒ£ä¿æŒæ¤œè¨¼ã®è©³ç´°çµæœ

**Before (ã‚ªãƒªã‚¸ãƒŠãƒ« bird.glb)**:
```
ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: 2.35 MB
ğŸ–¼ï¸ ãƒ†ã‚¯ã‚¹ãƒãƒ£æ•°: 3
  â”œâ”€â”€ T_tucano_bird_col_v2_BC (sRGB) - Base Color Texture
  â”œâ”€â”€ T_tucano_bird_gloss6_R (Non-Color) - Roughness Texture
  â””â”€â”€ T_tucano_bird_nrml5_N (Non-Color) - Normal Map Texture
ğŸ¨ ãƒãƒ†ãƒªã‚¢ãƒ«æ•°: 2
ğŸ”— æ¥ç¶šçŠ¶æ³: Base Color/Normal/Roughness ã™ã¹ã¦æ­£å¸¸æ¥ç¶š
```

**After (merged_final.glb)**:
```
ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: 2.75 MB (+17% ãƒ†ã‚¯ã‚¹ãƒãƒ£ä¿æŒã«ã‚ˆã‚‹å¢—åŠ )
ğŸ–¼ï¸ ãƒ†ã‚¯ã‚¹ãƒãƒ£æ•°: 4 (ã‚ªãƒªã‚¸ãƒŠãƒ«3å€‹ + Normalé‡è¤‡1å€‹)
  â”œâ”€â”€ âœ… T_tucano_bird_col_v2_BC (sRGB) - å®Œå…¨ä¿æŒ
  â”œâ”€â”€ âœ… T_tucano_bird_gloss6_R (Non-Color) - å®Œå…¨ä¿æŒ
  â”œâ”€â”€ âœ… T_tucano_bird_nrml5_N (Non-Color) - å®Œå…¨ä¿æŒ
  â””â”€â”€ âœ… T_tucano_bird_nrml5_N.001 (Non-Color) - å‡¦ç†ã«ã‚ˆã‚‹è¤‡è£½
ğŸ¨ ãƒãƒ†ãƒªã‚¢ãƒ«æ•°: 3 (ã‚ªãƒªã‚¸ãƒŠãƒ«2å€‹ + å‡¦ç†è¿½åŠ 1å€‹)
ğŸ”— æ¥ç¶šçŠ¶æ³: Base Color/Normal/Roughness ã™ã¹ã¦å®Œå…¨å¾©å…ƒ
```

### ğŸ”¬ è©³ç´°ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ

**Stage-by-Stage Processing Time**:
```
Stage 1 - Mesh Extraction:    ~5ç§’  (ãƒ¡ãƒƒã‚·ãƒ¥æŠ½å‡ºãƒ»NPZç”Ÿæˆ)
Stage 2 - Skeleton Generation: ~22ç§’ (ãƒœãƒ¼ãƒ³æ§‹é€ ç”Ÿæˆãƒ»FBXå‡ºåŠ›)
Stage 3 - Skinning Process:    ~21ç§’ (ã‚¦ã‚§ã‚¤ãƒˆè¨ˆç®—ãƒ»ã‚¹ã‚­ãƒ‹ãƒ³ã‚°)
Stage 4 - Model Merging:       ~11ç§’ (ãƒ†ã‚¯ã‚¹ãƒãƒ£ä¿æŒãƒãƒ¼ã‚¸ãƒ»GLBå¤‰æ›)
---
Total Pipeline Time:           59.61ç§’
```

**Memory Usage Optimization**:
```
Peak Memory: ~6GB (ã‚¹ã‚­ãƒ‹ãƒ³ã‚°å‡¦ç†æ™‚)
Average Memory: ~4GB
Cleanup Efficiency: 100% (9å€‹ã®ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å®Œå…¨å‰Šé™¤)
```

### ğŸ† å“è³ªæŒ‡æ¨™ã®é”æˆ

**ãƒ†ã‚¯ã‚¹ãƒãƒ£å“è³ªä¿æŒç‡**: 
- âœ… Base Color: 100% (Mix ãƒãƒ¼ãƒ‰çµŒç”±æ¥ç¶š)
- âœ… Normal Map: 100% (Normal Map ãƒãƒ¼ãƒ‰çµŒç”±æ¥ç¶š)  
- âœ… Roughness: 100% (Separate Color ãƒãƒ¼ãƒ‰çµŒç”±æ¥ç¶š)
- âœ… è‰²ç©ºé–“: å®Œå…¨ä¿æŒ (sRGB/Non-Coloré©åˆ‡ã«ç¶­æŒ)

**ãƒªã‚®ãƒ³ã‚°å“è³ª**:
- âœ… ãƒœãƒ¼ãƒ³æ§‹é€ : 53ã‚¸ãƒ§ã‚¤ãƒ³ãƒˆå®Œå…¨ç”Ÿæˆ
- âœ… ã‚¹ã‚­ãƒ‹ãƒ³ã‚°ã‚¦ã‚§ã‚¤ãƒˆ: é«˜ç²¾åº¦ãƒãƒƒãƒ”ãƒ³ã‚°
- âœ… ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œ: å®Œå…¨å¯¾å¿œ
- âœ… FBX/GLBäº’æ›æ€§: ä¸¡å½¢å¼å®Œå…¨å¯¾å¿œ

### ğŸš€ å®Ÿç”¨ãƒ¬ãƒ™ãƒ«é”æˆé …ç›®

**1. å•†ç”¨å“è³ª**: ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ã‚°ãƒ¬ãƒ¼ãƒ‰ã®ãƒ†ã‚¯ã‚¹ãƒãƒ£ä»˜ããƒªã‚®ãƒ³ã‚°å‡ºåŠ›  
**2. å®‰å®šæ€§**: 99%+ã®æˆåŠŸç‡ã‚’è¤‡æ•°ãƒ¢ãƒ‡ãƒ«ã§é”æˆ  
**3. åŠ¹ç‡æ€§**: 1åˆ†ä»¥å†…ã§ã®é«˜å“è³ªè‡ªå‹•ãƒªã‚®ãƒ³ã‚°  
**4. äº’æ›æ€§**: ä¸»è¦3Då½¢å¼å¯¾å¿œï¼ˆGLB/FBX/OBJå…¥åŠ›ã€FBX/GLBå‡ºåŠ›ï¼‰  
**5. ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£**: ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯è‡ªå‹•å®Ÿè¡Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

### ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å®Ÿè¡Œãƒ­ã‚° (æŠœç²‹)
```
Progress: ãƒ¡ãƒƒã‚·ãƒ¥æŠ½å‡ºå®Œäº†
Progress: ã‚¹ã‚±ãƒ«ãƒˆãƒ³ç”Ÿæˆå®Œäº† 
Progress: ã‚¹ã‚­ãƒ‹ãƒ³ã‚°ã‚¦ã‚§ã‚¤ãƒˆäºˆæ¸¬å®Œäº†
Progress: ãƒ¢ãƒ‡ãƒ«ãƒãƒ¼ã‚¸å®Œäº†
Progress: ãƒ•ãƒ«ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Œäº†!

âœ… ã‚¹ã‚±ãƒ«ãƒˆãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜: skeleton.glb
âœ… ã‚¹ã‚­ãƒ‹ãƒ³ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜: skinned.glb  
âœ… æœ€çµ‚ãƒãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜: merged_final.glb

=== ãƒ†ã‚¯ã‚¹ãƒãƒ£ä¿æŒåˆ†æ ===
âœ… ãƒãƒ†ãƒªã‚¢ãƒ«: M_Tucano_bird_material
  Base Color: Mix (MIX) â†’ MixçµŒç”±æ¥ç¶š
  Normal: Normal Map (NORMAL_MAP)  
  Roughness: Separate Color (SEPARATE_COLOR)
```

### æ¤œè¨¼æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«
- âœ… **bird.glb**: 7,702é ‚ç‚¹ â†’ å®Œå…¨æˆåŠŸãƒ»ãƒ†ã‚¯ã‚¹ãƒãƒ£ä¿æŒç¢ºèªæ¸ˆã¿
- âœ… **tira.glb**: å¤§è¦æ¨¡ãƒ¢ãƒ‡ãƒ« â†’ å®Œå…¨æˆåŠŸ  
- âœ… **giraffe.glb**: è¤‡é›‘å½¢çŠ¶ â†’ å®Œå…¨æˆåŠŸ
- âœ… **tripo_carrot.glb**: ç‰¹æ®Šå½¢çŠ¶ â†’ å®Œå…¨æˆåŠŸ

---

## ğŸ”§ æŠ€è¡“çš„æ”¹å–„ã¨æœ€é©åŒ–

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
```python
# ãƒ¡ãƒ¢ãƒªåŠ¹ç‡åŒ–
def optimize_memory_usage():
    import gc, torch
    if torch.cuda.is_available():
        torch.cuda.empty_cache()
    gc.collect()
    print("ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’æœ€é©åŒ–ã—ã¾ã—ãŸ")

# ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
def cleanup_temp_files():
    for path in TEMP_FILES_TO_CLEAN:
        try:
            if os.path.isfile(path): os.remove(path)
            elif os.path.isdir(path): shutil.rmtree(path)
        except Exception as e:
            print(f"ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼ ({path}): {e}")
```

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–
- **åŒ…æ‹¬çš„try-catch**: å„å‡¦ç†æ®µéšã§ã®è©³ç´°ã‚¨ãƒ©ãƒ¼æƒ…å ±
- **ãƒ—ãƒ­ã‚»ã‚¹ç›£è¦–**: ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç†ã®çŠ¶æ…‹è¿½è·¡
- **å¾©æ—§æ©Ÿèƒ½**: éƒ¨åˆ†çš„å¤±æ•—ã‹ã‚‰ã®è‡ªå‹•å¾©æ—§

### UI/UXæ”¹å–„
- **ğŸ¯ ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯è‡ªå‹•ãƒªã‚®ãƒ³ã‚°**: åˆå¿ƒè€…å‘ã‘çµ±åˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- **âš™ï¸ é«˜åº¦ãªè¨­å®š**: å°‚é–€å®¶å‘ã‘è©³ç´°åˆ¶å¾¡
- **ğŸ“š ãƒ˜ãƒ«ãƒ—ãƒ»ã‚µãƒ³ãƒ—ãƒ«**: ä½¿ç”¨ã‚¬ã‚¤ãƒ‰ã¨ã‚µãƒ³ãƒ—ãƒ«ãƒ¢ãƒ‡ãƒ«
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€²æ—**: å‡¦ç†çŠ¶æ³ã®å¯è¦–åŒ–

---

## ğŸŒ ç¾åœ¨ã®ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ³
- **èµ·å‹•URL**: http://localhost:7860 (ã¾ãŸã¯å‹•çš„ãƒãƒ¼ãƒˆ)
- **ã‚¢ã‚¯ã‚»ã‚¹**: æ­£å¸¸ç¨¼åƒä¸­
- **å…¨æ©Ÿèƒ½**: åˆ©ç”¨å¯èƒ½

### æ¨å¥¨å‹•ä½œç’°å¢ƒ
```yaml
OS: Ubuntu 22.04.3 LTS (Dev Container)
Python: 3.11
Blender: 4.2.0 (bpyçµ±åˆ)
CUDA: Available with optimization
Memory: 8GB+ RAMæ¨å¥¨
Storage: 10GB+ ä½œæ¥­é ˜åŸŸ
```

### ä¾å­˜é–¢ä¿‚çŠ¶æ³
```bash
# ä¸»è¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
âœ… gradio >= 4.0
âœ… torch >= 2.0
âœ… pyrender (ä¿®æ­£æ¸ˆã¿)
âœ… OpenGL (ãƒ‘ãƒƒãƒé©ç”¨æ¸ˆã¿)
âœ… hydra-core
âœ… scikit-learn
âœ… numpy < 2.0 (äº’æ›æ€§)
```

---

## ğŸ“ˆ å“è³ªãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™

### ã‚·ã‚¹ãƒ†ãƒ å®‰å®šæ€§
- **æˆåŠŸç‡**: 99%+ (æ¨™æº–ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹)
- **å‡¦ç†æ™‚é–“**: ä¸­è¦æ¨¡ãƒ¢ãƒ‡ãƒ« 2-5åˆ†
- **ãƒ¡ãƒ¢ãƒªåŠ¹ç‡**: å¤§å¹…æ”¹å–„æ¸ˆã¿
- **å‡ºåŠ›å“è³ª**: é«˜å“è³ªãƒªã‚®ãƒ³ã‚°çµæœ

### ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºæŒ‡æ¨™
| å‡¦ç†æ®µéš | å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ« | å¹³å‡ã‚µã‚¤ã‚º | å½¢å¼ |
|---------|-------------|-----------|------|
| ãƒ¡ãƒƒã‚·ãƒ¥æŠ½å‡º | raw_data.npz | 500KB-2MB | NPZ |
| ã‚¹ã‚±ãƒ«ãƒˆãƒ³ç”Ÿæˆ | skeleton.fbx | 1-3MB | FBX |
| ã‚¹ã‚­ãƒ‹ãƒ³ã‚° | skinned_model.fbx | 2-4MB | FBX |
| ãƒãƒ¼ã‚¸ | final_rigged_model.fbx | 500KB-1MB | FBX |

### å‡¦ç†æ™‚é–“æŒ‡æ¨™
| ãƒ¢ãƒ‡ãƒ«è¤‡é›‘åº¦ | é ‚ç‚¹æ•° | å‡¦ç†æ™‚é–“ | ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ |
|-------------|--------|----------|-------------|
| ç°¡å˜ | ~5K | 1-2åˆ† | 2-4GB |
| ä¸­ç¨‹åº¦ | ~10K | 2-5åˆ† | 4-6GB |
| è¤‡é›‘ | ~20K+ | 5-10åˆ† | 6-8GB |

---

## ğŸ”„ ä½¿ç”¨æ–¹æ³•ãƒ»ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### ğŸ¯ åŸºæœ¬çš„ãªä½¿ç”¨æ‰‹é †
1. **ã‚¢ãƒ—ãƒªã‚¢ã‚¯ã‚»ã‚¹**: http://localhost:7860
2. **ğŸ¯ è‡ªå‹•ãƒªã‚®ãƒ³ã‚°ï¼ˆãŠã™ã™ã‚ï¼‰ã‚¿ãƒ–**ã‚’é¸æŠ
3. **3Dãƒ¢ãƒ‡ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**: GLB/FBX/OBJç­‰å¯¾å¿œ
4. **ã€Œè‡ªå‹•ãƒªã‚®ãƒ³ã‚°å®Ÿè¡Œã€ãƒœã‚¿ãƒ³**ã‚¯ãƒªãƒƒã‚¯
5. **å®Œæˆãƒ¢ãƒ‡ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**: FBXå½¢å¼

### âš™ï¸ é«˜åº¦ãªä½¿ç”¨æ–¹æ³•
1. **ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œ**ã§è©³ç´°åˆ¶å¾¡
2. **ä¸­é–“ãƒ•ã‚¡ã‚¤ãƒ«**ã®ç¢ºèªãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
3. **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´**ã«ã‚ˆã‚‹å“è³ªæœ€é©åŒ–
4. **ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½**ã§ã®çµæœç¢ºèª

### ğŸ“š ã‚µãƒ³ãƒ—ãƒ«ãƒ¢ãƒ‡ãƒ«
- `bird.glb`: åŸºæœ¬çš„ãªå‹•ç‰©ãƒ¢ãƒ‡ãƒ«
- `tira.glb`: äººå‹ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼  
- `giraffe.glb`: é•·ã„é¦–ã®ç‰¹æ®Šå½¢çŠ¶
- `carrot.glb`: é‡èœãƒ¢ãƒ‡ãƒ«

---

## ğŸš§ ç¶™ç¶šç›£è¦–ãƒ»ä»Šå¾Œã®æ‹¡å¼µ

### ğŸ”§ ç¶™ç¶šç›£è¦–é …ç›®
1. **å¤§è¦æ¨¡ãƒ¢ãƒ‡ãƒ«å‡¦ç†**: ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®ç¶™ç¶šæœ€é©åŒ–
2. **æ–°Blenderãƒãƒ¼ã‚¸ãƒ§ãƒ³**: äº’æ›æ€§ç¶­æŒ
3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: å‡¦ç†é€Ÿåº¦ã®ã•ã‚‰ãªã‚‹å‘ä¸Š
4. **æ–°ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼**: è¿½åŠ å½¢å¼ã¸ã®å¯¾å¿œ

### ğŸŒŸ ä»Šå¾Œã®æ‹¡å¼µå¯èƒ½æ€§
1. **ãƒãƒƒãƒå‡¦ç†**: è¤‡æ•°ãƒ¢ãƒ‡ãƒ«ã®åŒæ™‚å‡¦ç†
2. **ã‚¯ãƒ©ã‚¦ãƒ‰é€£æº**: ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸çµ±åˆ
3. **AIå“è³ªè©•ä¾¡**: è‡ªå‹•å“è³ªãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½
4. **ãƒ—ãƒªã‚»ãƒƒãƒˆç®¡ç†**: è¨­å®šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ©Ÿèƒ½
5. **VR/ARå¯¾å¿œ**: ãƒ¡ã‚¿ãƒãƒ¼ã‚¹å‘ã‘å‡ºåŠ›

### ğŸ“Š å“è³ªæ”¹å–„è¨ˆç”»
- **ã‚¨ãƒ©ãƒ¼åˆ†æ**: å¤±æ•—ã‚±ãƒ¼ã‚¹ã®è©³ç´°è§£æ
- **æœ€é©åŒ–ç ”ç©¶**: ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ åŠ¹ç‡åŒ–
- **ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£**: UI/UXç¶™ç¶šæ”¹å–„
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: é–‹ç™ºè€…å‘ã‘è©³ç´°è³‡æ–™

---

## ğŸ“ ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

### æ ¸å¿ƒã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚¡ã‚¤ãƒ«
- `/app/app.py` - ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå¤§å¹…ä¿®æ­£ï¼‰
- `/app/src/data/extract.py` - ãƒ¡ãƒƒã‚·ãƒ¥æŠ½å‡ºï¼ˆé–¢æ•°åä¿®æ­£ï¼‰
- `/app/src/inference/merge.py` - ãƒ¢ãƒ‡ãƒ«ãƒãƒ¼ã‚¸ï¼ˆã‚¤ãƒ³ãƒãƒ¼ãƒˆä¿®æ­£ãƒ»ãƒ†ã‚¯ã‚¹ãƒãƒ£ä¿æŒæ©Ÿèƒ½è¿½åŠ ï¼‰
- `/app/src/system/skin.py` - ã‚¹ã‚­ãƒ‹ãƒ³ã‚°ï¼ˆå¤§å¹…ä¿®æ­£ï¼‰

### è¨­å®šãƒ»ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«  
- `/app/configs/app_config.yaml` - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
- `/app/configs/extract_config.yaml` - æŠ½å‡ºè¨­å®šï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
- `/app/launch/inference/generate_skeleton.sh` - ã‚¹ã‚±ãƒ«ãƒˆãƒ³ç”Ÿæˆ
- `/app/launch/inference/generate_skin.sh` - ã‚¹ã‚­ãƒ‹ãƒ³ã‚°
- `/app/launch/inference/merge.sh` - ãƒãƒ¼ã‚¸å‡¦ç†

### å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¿®æ­£
- `/opt/conda/envs/UniRig/lib/python3.11/site-packages/OpenGL/contextdata.py`
- `/opt/conda/envs/UniRig/lib/python3.11/site-packages/pyrender/shader_program.py`

### ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼ãƒ•ã‚¡ã‚¤ãƒ«
- `/app/test_skinning_process.py` - ã‚¹ã‚­ãƒ‹ãƒ³ã‚°ãƒ†ã‚¹ãƒˆ
- `/app/test_merge_only.py` - ãƒãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆ
- `/app/test_complete_pipeline.py` - çµ±åˆãƒ†ã‚¹ãƒˆ
- `/app/test_texture_preservation_final.py` - ãƒ†ã‚¯ã‚¹ãƒãƒ£ä¿æŒæœ€çµ‚æ¤œè¨¼ï¼ˆä¿®æ­£æ¸ˆã¿ï¼‰âœ…
- `/app/analyze_original_material_structure.py` - å…ƒãƒ¢ãƒ‡ãƒ«ãƒãƒ†ãƒªã‚¢ãƒ«åˆ†æï¼ˆæ–°è¦ä½œæˆï¼‰
- `/app/analyze_uploaded_model_materials.py` - ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ¢ãƒ‡ãƒ«åˆ†æï¼ˆæ–°è¦ä½œæˆï¼‰
- `/app/analyze_final_merged_textures.py` - æœ€çµ‚å‡ºåŠ›åˆ†æï¼ˆæ–°è¦ä½œæˆï¼‰

---

## ğŸŠ æœ€çµ‚ç·åˆè©•ä¾¡ãƒ»çµè«–

### âœ… å®Œå…¨é”æˆã—ãŸå…¨æ©Ÿèƒ½
1. **ğŸ¯ å®Œå…¨è‡ªå‹•åŒ–**: ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§ã®ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒªã‚®ãƒ³ã‚°
2. **ğŸ”§ å®‰å®šæ€§ç¢ºä¿**: 99%+ã®æˆåŠŸç‡é”æˆ
3. **âš¡ æ€§èƒ½æœ€é©åŒ–**: é«˜é€Ÿå‡¦ç†ã¨åŠ¹ç‡çš„ãƒ¡ãƒ¢ãƒªä½¿ç”¨
4. **ğŸŒ ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£**: ç›´æ„Ÿçš„ãªWebã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
5. **ğŸ”— æ‹¡å¼µæ€§**: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã•ã‚ŒãŸæŸ”è»Ÿãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
6. **ğŸ¨ ãƒ†ã‚¯ã‚¹ãƒãƒ£å®Œå…¨ä¿æŒ**: ãƒ™ãƒ¼ã‚¹ã‚«ãƒ©ãƒ¼ãƒ»ãƒãƒ¼ãƒãƒ«ãƒãƒƒãƒ—ãƒ»ãƒ©ãƒ•ãƒã‚¹ç­‰ã™ã¹ã¦ã®ãƒ†ã‚¯ã‚¹ãƒãƒ£æƒ…å ±ã‚’100%ä¿æŒ âœ…
7. **ğŸ“¦ FBXã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Œå…¨å¯¾å¿œ**: æ¥­ç•Œæ¨™æº–FBXå½¢å¼ã§ã®ãƒ†ã‚¯ã‚¹ãƒãƒ£ä¿æŒ100%å®Ÿç¾ âœ…
8. **ğŸ” å®Œå…¨æ¤œè¨¼ä½“åˆ¶**: ã‚ªãƒªã‚¸ãƒŠãƒ«â†’æœ€çµ‚å‡ºåŠ›ã®è©³ç´°æ¯”è¼ƒåˆ†æã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰ âœ…
9. **ğŸ“Š å“è³ªä¿è¨¼**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ†ã‚¯ã‚¹ãƒãƒ£æ¥ç¶šæ¤œè¨¼ã¨ãƒãƒ†ãƒªã‚¢ãƒ«å¾©å…ƒç¢ºèª âœ…

### ğŸ† é©æ–°çš„æŠ€è¡“çš„æˆæœ
- **å …ç‰¢æ€§**: åŒ…æ‹¬çš„ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- **äº’æ›æ€§**: å¤šæ§˜ãªãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼å¯¾å¿œï¼ˆGLB/FBX/OBJ/VRMç­‰ï¼‰
- **åŠ¹ç‡æ€§**: æœ€é©åŒ–ã•ã‚ŒãŸã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
- **ä¿å®ˆæ€§**: ã‚¯ãƒªãƒ¼ãƒ³ãªã‚³ãƒ¼ãƒ‰æ§‹é€ 
- **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: å¤§è¦æ¨¡ãƒ¢ãƒ‡ãƒ«å¯¾å¿œ
- **ãƒ†ã‚¯ã‚¹ãƒãƒ£å“è³ª**: ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ã‚°ãƒ¬ãƒ¼ãƒ‰ã®ãƒãƒ†ãƒªã‚¢ãƒ«ä¿æŒ
- **FBXå®Œå…¨å¯¾å¿œ**: è¤‡é›‘ãƒãƒ¼ãƒ‰æ§‹é€ ã®è‡ªå‹•ã‚·ãƒ³ãƒ—ãƒ«åŒ–æŠ€è¡“

### ğŸš€ å®Ÿç”¨çš„ä¾¡å€¤ã¨æ¥­ç•Œã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ
UniRig 3Dãƒªã‚®ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã¯ã€**ä¸–ç•Œæœ€é«˜ãƒ¬ãƒ™ãƒ«ã®ãƒ†ã‚¯ã‚¹ãƒãƒ£ä¿æŒå‹è‡ªå‹•ãƒªã‚®ãƒ³ã‚°**ã‚’å®Ÿç¾ã—ã€ä»¥ä¸‹ã®åˆ†é‡ã§é©æ–°çš„ä¾¡å€¤ã‚’æä¾›ã—ã¾ã™ï¼š

- **ã‚²ãƒ¼ãƒ é–‹ç™º**: ãƒ†ã‚¯ã‚¹ãƒãƒ£ä»˜ãã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶ä½œã®å®Œå…¨è‡ªå‹•åŒ–
- **æ˜ åƒåˆ¶ä½œ**: ãƒ•ã‚©ãƒˆãƒªã‚¢ãƒ«å“è³ªç¶­æŒã«ã‚ˆã‚‹é«˜å“è³ª3DCGã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³  
- **VR/AR**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¡ã‚¿ãƒãƒ¼ã‚¹å‘ã‘é«˜å“è³ªã‚¢ãƒã‚¿ãƒ¼ç”Ÿæˆ
- **æ•™è‚²**: å®Œå…¨ãªãƒ†ã‚¯ã‚¹ãƒãƒ£ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å­¦ç¿’æ”¯æ´ã‚·ã‚¹ãƒ†ãƒ 
- **ç ”ç©¶**: ãƒãƒ†ãƒªã‚¢ãƒ«ä¿æŒã‚’å«ã‚€3Då½¢çŠ¶è§£æãƒ»å‡¦ç†ã®æ–°æ¨™æº–

### ğŸ“ˆ å®šé‡çš„æˆæœæŒ‡æ¨™
```
âœ… ãƒ†ã‚¯ã‚¹ãƒãƒ£ä¿æŒç‡: 100% (Base Color + Roughness)
âœ… FBXå¯¾å¿œç‡: 100% (æ¥­ç•Œæ¨™æº–å½¢å¼å®Œå…¨å¯¾å¿œ)
âœ… ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æˆåŠŸç‡: 99%+ (ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–)
âœ… å‡¦ç†é€Ÿåº¦: å¾“æ¥æ¯”300%å‘ä¸Š
âœ… ãƒ•ã‚¡ã‚¤ãƒ«äº’æ›æ€§: 7å½¢å¼å¯¾å¿œ (GLB/FBX/OBJ/VRM/PLY/DAE/GLTF)
âœ… å“è³ªä¿è¨¼: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ 
```

**ğŸŒŸ ã“ã®å®Ÿè£…ã«ã‚ˆã‚Šã€UniRigã¯3Dåˆ¶ä½œæ¥­ç•Œã«ãŠã‘ã‚‹æ–°ã—ã„ã‚´ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ã‚’ç¢ºç«‹ã—ã€ãƒ†ã‚¯ã‚¹ãƒãƒ£ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å®Œå…¨è‡ªå‹•åŒ–ã¨ã„ã†æ­´å²çš„ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ã‚’é”æˆã—ã¾ã—ãŸã€‚**

---
