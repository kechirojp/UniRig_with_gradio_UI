# UniRig ãƒ¡ãƒƒã‚·ãƒ¥å“è³ªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼å®Œå…¨ã‚¬ã‚¤ãƒ‰

**ä½œæˆæ—¥**: 2025å¹´6æœˆ17æ—¥  
**å¯¾è±¡**: UniRigãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–‹ç™ºãƒãƒ¼ãƒ ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼  
**ç›®çš„**: ã‚¹ã‚±ãƒ«ãƒˆãƒ³ãƒ»ã‚¹ã‚­ãƒ‹ãƒ³ã‚°å“è³ªã‚’æ±ºå®šã™ã‚‹ãƒ¡ãƒƒã‚·ãƒ¥å‡¦ç†ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã®å®Œå…¨ç†è§£  
**é‡è¦åº¦**: **æœ€é«˜** (å“è³ªåˆ¶å¾¡ã®æ ¸å¿ƒæŠ€è¡“)

---

## ğŸ¯ æ¦‚è¦

UniRigã«ãŠã‘ã‚‹ãƒ¡ãƒƒã‚·ãƒ¥å“è³ªã¯ã€**ã‚¹ã‚±ãƒ«ãƒˆãƒ³ç”Ÿæˆã®ç²¾åº¦**ã¨**ã‚¹ã‚­ãƒ‹ãƒ³ã‚°ã®æ­£ç¢ºæ€§**ã‚’ç›´æ¥æ±ºå®šã™ã‚‹æœ€é‡è¦è¦ç´ ã§ã™ã€‚æœ¬æ–‡æ›¸ã§ã¯ã€ãƒ¡ãƒƒã‚·ãƒ¥å“è³ªã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã™ã‚‹å…¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã¨ãã®å½±éŸ¿ã‚’è©³ç´°ã«è§£èª¬ã—ã¾ã™ã€‚

---

## ğŸ“Š ãƒ¡ãƒƒã‚·ãƒ¥å“è³ªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼éšå±¤æ§‹é€ 

### ğŸ—ï¸ **ãƒ¬ãƒ™ãƒ«1: ãƒ¡ãƒƒã‚·ãƒ¥å‰å‡¦ç†ï¼ˆsrc.data.extractï¼‰**
```
ãƒ¡ãƒƒã‚·ãƒ¥æŠ½å‡ºãƒ»å‰å‡¦ç†æ®µéšã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼
â”œâ”€â”€ faces_target_countï¼ˆé¢æ•°åˆ¶å¾¡ï¼‰
â”œâ”€â”€ ãƒ¡ãƒƒã‚·ãƒ¥æ­£è¦åŒ–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼
â”œâ”€â”€ UVåº§æ¨™ä¿æŒè¨­å®š
â””â”€â”€ ãƒãƒ†ãƒªã‚¢ãƒ«æƒ…å ±ä¿æŒè¨­å®š
```

### ğŸ§  **ãƒ¬ãƒ™ãƒ«2: AIæ¨è«–ï¼ˆã‚¹ã‚±ãƒ«ãƒˆãƒ³ç”Ÿæˆï¼‰**
```
AI ãƒ¢ãƒ‡ãƒ«ãŒãƒ¡ãƒƒã‚·ãƒ¥ã‚’ç†è§£ã™ã‚‹æ®µéšã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼
â”œâ”€â”€ mesh_encoder è¨­å®š
â”œâ”€â”€ ãƒˆãƒ¼ã‚¯ãƒŠã‚¤ã‚¶ãƒ¼è¨­å®š
â””â”€â”€ æ¨è«–åˆ¶å¾¡ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼
```

### ğŸ”— **ãƒ¬ãƒ™ãƒ«3: ã‚¹ã‚­ãƒ‹ãƒ³ã‚°å‡¦ç†**
```
ãƒ¡ãƒƒã‚·ãƒ¥ã¨ã‚¹ã‚±ãƒ«ãƒˆãƒ³ã‚’çµåˆã™ã‚‹æ®µéšã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼
â”œâ”€â”€ ã‚¹ã‚­ãƒ‹ãƒ³ã‚°ç‰¹åŒ–ãƒ¡ãƒƒã‚·ãƒ¥å‡¦ç†
â”œâ”€â”€ ã‚¦ã‚§ã‚¤ãƒˆè¨ˆç®—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼
â””â”€â”€ ãƒœãƒ¼ãƒ³å½±éŸ¿ç¯„å›²è¨­å®š
```

---

## ğŸ”§ **ãƒ¬ãƒ™ãƒ«1: ãƒ¡ãƒƒã‚·ãƒ¥å‰å‡¦ç†ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼è©³ç´°**

### **1.1 faces_target_countï¼ˆæœ€é‡è¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ï¼‰**

**è¨­å®šå ´æ‰€**: `src.data.extract` å®Ÿè¡Œæ™‚ã® `--faces_target_count` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼

**ç¾åœ¨ã®è¨­å®š**:
```python
# Step1: æ±ç”¨ãƒ¡ãƒƒã‚·ãƒ¥æŠ½å‡ºï¼ˆè©³ç´°ä¿æŒé‡è¦–ï¼‰
faces_target_count = æœªæŒ‡å®šï¼ˆå…ƒãƒ¡ãƒƒã‚·ãƒ¥ä¾å­˜ï¼‰

# Step2: AIæ¨è«–ç‰¹åŒ–ãƒ¡ãƒƒã‚·ãƒ¥ï¼ˆã‚¹ã‚±ãƒ«ãƒˆãƒ³ç”Ÿæˆæœ€é©åŒ–ï¼‰
faces_target_count = 4000

# Step3: ã‚¹ã‚­ãƒ‹ãƒ³ã‚°ç‰¹åŒ–ãƒ¡ãƒƒã‚·ãƒ¥ï¼ˆã‚¦ã‚§ã‚¤ãƒˆè¨ˆç®—æœ€é©åŒ–ï¼‰
faces_target_count = 50000
```

**å“è³ªã¸ã®å½±éŸ¿**:
```
é¢æ•° 1,000-2,000:   ç°¡æ˜“ã‚¹ã‚±ãƒ«ãƒˆãƒ³ï¼ˆä½å“è³ªï¼‰
é¢æ•° 4,000:         æ¨™æº–ã‚¹ã‚±ãƒ«ãƒˆãƒ³å“è³ªï¼ˆAIæ¨è«–æœ€é©åŒ–ï¼‰
é¢æ•° 10,000-20,000: é«˜å“è³ªã‚¹ã‚±ãƒ«ãƒˆãƒ³
é¢æ•° 50,000+:       è¶…é«˜å“è³ªï¼ˆã‚¹ã‚­ãƒ‹ãƒ³ã‚°æœ€é©åŒ–ï¼‰
é¢æ•° 100,000+:      ã‚ªãƒ¼ãƒãƒ¼ã‚¹ãƒšãƒƒã‚¯ï¼ˆå‡¦ç†æ™‚é–“å¢—å¤§ï¼‰
```

**èª¿æ•´æŒ‡é‡**:
```yaml
# é«˜å“è³ªã‚¹ã‚±ãƒ«ãƒˆãƒ³ã‚’æ±‚ã‚ã‚‹å ´åˆ
faces_target_count: 8000  # Step2ç”¨ï¼ˆç¾åœ¨4000ã‹ã‚‰å€å¢—ï¼‰

# è¶…é«˜å“è³ªã‚¹ã‚­ãƒ‹ãƒ³ã‚°ã‚’æ±‚ã‚ã‚‹å ´åˆ  
faces_target_count: 80000  # Step3ç”¨ï¼ˆç¾åœ¨50000ã‹ã‚‰å¢—å¼·ï¼‰
```

### **1.2 ãƒ¡ãƒƒã‚·ãƒ¥æ­£è¦åŒ–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼**

**è¨­å®šå ´æ‰€**: `configs/data/quick_inference.yaml`

```yaml
# ç¾åœ¨ã®è¨­å®š
data:
  # ãƒ¡ãƒƒã‚·ãƒ¥æ­£è¦åŒ–è¨­å®š
  normalize_mesh: true
  center_mesh: true
  scale_to_unit: true
  
  # UVåº§æ¨™ä¿æŒï¼ˆStep5ãƒ†ã‚¯ã‚¹ãƒãƒ£çµ±åˆç”¨ï¼‰
  preserve_uv_coordinates: true
  preserve_material_info: true
```

**å“è³ªã¸ã®å½±éŸ¿**:
- `normalize_mesh: true`: ãƒ¡ãƒƒã‚·ãƒ¥ã‚µã‚¤ã‚ºæ­£è¦åŒ–ï¼ˆAIæ¨è«–ç²¾åº¦å‘ä¸Šï¼‰
- `center_mesh: true`: ä¸­å¿ƒä½ç½®èª¿æ•´ï¼ˆå·¦å³å¯¾ç§°æ€§å‘ä¸Šï¼‰
- `scale_to_unit: true`: å˜ä½ã‚¹ã‚±ãƒ¼ãƒ«æ­£è¦åŒ–ï¼ˆéª¨é•·è¨ˆç®—ç²¾åº¦å‘ä¸Šï¼‰

### **1.3 ãƒ¡ãƒƒã‚·ãƒ¥å‰å‡¦ç†è©³ç´°åˆ¶å¾¡**

**è¨­å®šå ´æ‰€**: `src/data/extract.py` å†…éƒ¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼

```python
# ãƒ¡ãƒƒã‚·ãƒ¥å“è³ªåˆ¶å¾¡ã®è©³ç´°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼
class MeshExtractionConfig:
    # é ‚ç‚¹å¯†åº¦åˆ¶å¾¡
    vertex_density_threshold: float = 0.01
    
    # ã‚¨ãƒƒã‚¸é•·åˆ¶å¾¡
    max_edge_length: float = 0.05
    min_edge_length: float = 0.001
    
    # é¢ã®å“è³ªåˆ¶å¾¡
    min_face_area: float = 0.0001
    max_aspect_ratio: float = 10.0
    
    # æ­£è¦åŒ–è¨­å®š
    mesh_scale_factor: float = 1.0
    center_offset: tuple = (0.0, 0.0, 0.0)
```

---

## ğŸ§  **ãƒ¬ãƒ™ãƒ«2: AIæ¨è«–å“è³ªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼è©³ç´°**

### **2.1 ãƒ¡ãƒƒã‚·ãƒ¥ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼è¨­å®š**

**è¨­å®šå ´æ‰€**: `configs/model/unirig_ar_350m_1024_81920_float32.yaml`

```yaml
mesh_encoder:
  # ãƒ¡ãƒƒã‚·ãƒ¥ç†è§£ã®è©³ç´°åº¦ï¼ˆæœ€é‡è¦ï¼‰
  num_latents: 1024           # ç¾åœ¨å€¤ï¼ˆæ¨™æº–ï¼‰
  # æ¨å¥¨: 2048ï¼ˆé«˜å“è³ªï¼‰ã€4096ï¼ˆè¶…é«˜å“è³ªï¼‰
  
  # ç‰¹å¾´è¡¨ç¾ã®è¤‡é›‘æ€§
  embed_dim: 128              # ç¾åœ¨å€¤ï¼ˆæ¨™æº–ï¼‰  
  # æ¨å¥¨: 256ï¼ˆé«˜å“è³ªï¼‰ã€512ï¼ˆè¶…é«˜å“è³ªï¼‰
  
  # ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã®æ·±åº¦
  num_encoder_layers: 16      # ç¾åœ¨å€¤ï¼ˆæ¨™æº–ï¼‰
  # æ¨å¥¨: 24ï¼ˆé«˜å“è³ªï¼‰ã€32ï¼ˆè¶…é«˜å“è³ªï¼‰
  
  # ã‚¢ãƒ†ãƒ³ã‚·ãƒ§ãƒ³æ©Ÿæ§‹ã®å¤šæ§˜æ€§
  heads: 8                    # ç¾åœ¨å€¤ï¼ˆæ¨™æº–ï¼‰
  # æ¨å¥¨: 16ï¼ˆé«˜å“è³ªï¼‰ã€32ï¼ˆè¶…é«˜å“è³ªï¼‰
  
  # ãƒ¡ãƒƒã‚·ãƒ¥ç‰¹å¾´æŠ½å‡ºç²¾åº¦
  positional_encoding_dim: 64
  geometric_feature_dim: 128
  surface_feature_dim: 256
```

**å“è³ªå‘ä¸Šè¨­å®šä¾‹**:
```yaml
# ğŸ”¥ é«˜å“è³ªã‚¹ã‚±ãƒ«ãƒˆãƒ³ç”Ÿæˆè¨­å®š
mesh_encoder:
  num_latents: 2048           # å€å¢—: ã‚ˆã‚Šè©³ç´°ãªãƒ¡ãƒƒã‚·ãƒ¥ç†è§£
  embed_dim: 256              # å€å¢—: ã‚ˆã‚Šè±Šå¯Œãªç‰¹å¾´è¡¨ç¾
  num_encoder_layers: 24      # 1.5å€: ã‚ˆã‚Šæ·±ã„è§£æ
  heads: 16                   # å€å¢—: ã‚ˆã‚Šå¤šè§’çš„ãªè§£æ
```

### **2.2 ãƒˆãƒ¼ã‚¯ãƒŠã‚¤ã‚¶ãƒ¼å“è³ªè¨­å®š**

**è¨­å®šå ´æ‰€**: `configs/components/tokenizer/tokenizer_parts_articulationxl_256.yaml`

```yaml
tokenizer:
  # ã‚¹ã‚±ãƒ«ãƒˆãƒ³æ§‹é€ ã®è©³ç´°åº¦
  vocab_size: 81920           # ç¾åœ¨å€¤ï¼ˆæ¨™æº–ï¼‰
  # æ¨å¥¨: 163840ï¼ˆå€å¢—ã€é«˜å“è³ªï¼‰
  
  # ãƒœãƒ¼ãƒ³é–¢ç¯€ã®è§£åƒåº¦
  max_sequence_length: 4096   # ç¾åœ¨å€¤ï¼ˆæ¨™æº–ï¼‰
  # æ¨å¥¨: 8192ï¼ˆé«˜å“è³ªï¼‰ã€16384ï¼ˆè¶…é«˜å“è³ªï¼‰
  
  # éª¨æ ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å¤šæ§˜æ€§
  num_parts: 256              # ç¾åœ¨å€¤ï¼ˆæ¨™æº–ï¼‰
  # æ¨å¥¨: 512ï¼ˆé«˜å“è³ªï¼‰ã€1024ï¼ˆè¶…é«˜å“è³ªï¼‰
```

### **2.3 æ¨è«–åˆ¶å¾¡ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼**

**è¨­å®šå ´æ‰€**: `configs/system/ar_inference_articulationxl.yaml`

```yaml
generate_kwargs:
  # ã‚¹ã‚±ãƒ«ãƒˆãƒ³ã®è¤‡é›‘æ€§ä¸Šé™ï¼ˆæœ€é‡è¦ï¼‰
  max_new_tokens: 4096        # ç¾åœ¨å€¤ï¼ˆæ¨™æº–ï¼‰
  # æ¨å¥¨: 8192ï¼ˆé«˜å“è³ªï¼‰ã€16384ï¼ˆè¶…é«˜å“è³ªï¼‰
  
  # ã‚ˆã‚Šç²¾å¯†ãªæ¢ç´¢ï¼ˆé«˜å“è³ªåŒ–ï¼‰
  num_beams: 20               # ç¾åœ¨å€¤ï¼ˆæ¨™æº–ï¼‰
  # æ¨å¥¨: 40ï¼ˆé«˜å“è³ªï¼‰ã€80ï¼ˆè¶…é«˜å“è³ªï¼‰
  
  # å‰µé€ æ€§vså®‰å®šæ€§ã®ãƒãƒ©ãƒ³ã‚¹
  temperature: 1.5            # ç¾åœ¨å€¤ï¼ˆæ¨™æº–ï¼‰
  # æ¨å¥¨: 1.2ï¼ˆé«˜ç²¾åº¦ï¼‰ã€0.8ï¼ˆè¶…é«˜ç²¾åº¦ï¼‰
  
  # å€™è£œé¸æŠã®å¤šæ§˜æ€§
  top_k: 10                   # ç¾åœ¨å€¤ï¼ˆæ¨™æº–ï¼‰
  # æ¨å¥¨: 20ï¼ˆé«˜å“è³ªï¼‰ã€50ï¼ˆè¶…é«˜å“è³ªï¼‰
  
  # ç¢ºç‡çš„ã‚«ãƒƒãƒˆã‚ªãƒ•
  top_p: 0.95                 # ç¾åœ¨å€¤ï¼ˆæ¨™æº–ï¼‰
  # æ¨å¥¨: 0.98ï¼ˆé«˜ç²¾åº¦ï¼‰ã€0.99ï¼ˆè¶…é«˜ç²¾åº¦ï¼‰
  
  # é‡è¤‡ãƒ‘ã‚¿ãƒ¼ãƒ³é˜²æ­¢
  repetition_penalty: 3.0     # ç¾åœ¨å€¤ï¼ˆå¼·ï¼‰
  # æ¨å¥¨: 2.5ï¼ˆé«˜å“è³ªãƒãƒ©ãƒ³ã‚¹ï¼‰
```

---

## ğŸ”— **ãƒ¬ãƒ™ãƒ«3: ã‚¹ã‚­ãƒ‹ãƒ³ã‚°å“è³ªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼è©³ç´°**

### **3.1 ã‚¹ã‚­ãƒ‹ãƒ³ã‚°ç‰¹åŒ–ãƒ¡ãƒƒã‚·ãƒ¥å‡¦ç†**

**è¨­å®šå ´æ‰€**: Step3å®Ÿè¡Œæ™‚ã®ãƒ¡ãƒƒã‚·ãƒ¥å†æŠ½å‡ºãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼

```python
# ç¾åœ¨ã®è¨­å®š
skinning_mesh_config = {
    "faces_target_count": 50000,    # ã‚¹ã‚­ãƒ‹ãƒ³ã‚°æœ€é©åŒ–
    "preserve_vertex_groups": True,  # ãƒãƒ¼ãƒ†ãƒƒã‚¯ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ä¿æŒ
    "maintain_topology": True,       # ãƒˆãƒãƒ­ã‚¸ãƒ¼ç¶­æŒ
    "smooth_surface": True          # è¡¨é¢å¹³æ»‘åŒ–
}

# é«˜å“è³ªè¨­å®šæ¡ˆ
ultra_quality_skinning_config = {
    "faces_target_count": 100000,   # è¶…é«˜å¯†åº¦ãƒ¡ãƒƒã‚·ãƒ¥
    "vertex_density_factor": 2.0,   # é ‚ç‚¹å¯†åº¦å€å¢—
    "edge_subdivision_level": 2,    # ã‚¨ãƒƒã‚¸ç´°åˆ†åŒ–ãƒ¬ãƒ™ãƒ«
    "adaptive_refinement": True     # é©å¿œçš„è©³ç´°åŒ–
}
```

### **3.2 ã‚¦ã‚§ã‚¤ãƒˆè¨ˆç®—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼**

**è¨­å®šå ´æ‰€**: `configs/task/quick_inference_unirig_skin.yaml`

```yaml
skinning:
  # ã‚¦ã‚§ã‚¤ãƒˆè¨ˆç®—ç²¾åº¦
  weight_calculation_precision: "float32"  # ç¾åœ¨å€¤
  # æ¨å¥¨: "float64"ï¼ˆè¶…é«˜ç²¾åº¦ï¼‰
  
  # ãƒœãƒ¼ãƒ³å½±éŸ¿ç¯„å›²
  max_bone_influences: 4                   # ç¾åœ¨å€¤ï¼ˆæ¨™æº–ï¼‰
  # æ¨å¥¨: 8ï¼ˆé«˜å“è³ªï¼‰ã€16ï¼ˆè¶…é«˜å“è³ªï¼‰
  
  # ã‚¦ã‚§ã‚¤ãƒˆæ­£è¦åŒ–
  normalize_weights: true
  smooth_weights: true
  
  # è·é›¢è¨ˆç®—æ–¹å¼
  distance_metric: "euclidean"             # ç¾åœ¨å€¤
  # é¸æŠè‚¢: "geodesic"ï¼ˆé«˜å“è³ªï¼‰ã€"harmonic"ï¼ˆè¶…é«˜å“è³ªï¼‰
```

### **3.3 ãƒœãƒ¼ãƒ³-é ‚ç‚¹çµåˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼**

```yaml
bone_vertex_binding:
  # çµåˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
  binding_algorithm: "heat_diffusion"      # ç¾åœ¨å€¤ï¼ˆæ¨™æº–ï¼‰
  # æ¨å¥¨: "laplacian_coordinates"ï¼ˆé«˜å“è³ªï¼‰
  
  # ç†±æ‹¡æ•£ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼
  heat_diffusion_iterations: 100          # ç¾åœ¨å€¤
  # æ¨å¥¨: 200ï¼ˆé«˜å“è³ªï¼‰ã€500ï¼ˆè¶…é«˜å“è³ªï¼‰
  
  # æ‹˜æŸæ¡ä»¶
  rigid_bone_constraints: true
  smooth_transition_zones: true
  
  # å“è³ªæ¤œè¨¼
  validate_weights: true
  weight_threshold: 0.001
```

---

## ğŸ¯ **å“è³ªè¨­å®šãƒ—ãƒªã‚»ãƒƒãƒˆ**

### **ğŸ”µ æ¨™æº–å“è³ªï¼ˆç¾åœ¨ã®è¨­å®šï¼‰**
```yaml
# å‡¦ç†æ™‚é–“: ç´„5-10åˆ†
# é©ç”¨å¯¾è±¡: ä¸€èˆ¬çš„ãª3Dãƒ¢ãƒ‡ãƒ«
mesh_quality: "standard"
faces_target_count: 4000 (Step2), 50000 (Step3)
mesh_encoder.num_latents: 1024
generate_kwargs.max_new_tokens: 4096
generate_kwargs.num_beams: 20
```

### **ğŸŸ¡ é«˜å“è³ªè¨­å®š**
```yaml
# å‡¦ç†æ™‚é–“: ç´„15-30åˆ†
# é©ç”¨å¯¾è±¡: è©³ç´°ãªã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ¢ãƒ‡ãƒ«
mesh_quality: "high"
faces_target_count: 8000 (Step2), 80000 (Step3)
mesh_encoder.num_latents: 2048
generate_kwargs.max_new_tokens: 8192
generate_kwargs.num_beams: 40
```

### **ğŸ”´ è¶…é«˜å“è³ªè¨­å®š**
```yaml
# å‡¦ç†æ™‚é–“: ç´„45-90åˆ†
# é©ç”¨å¯¾è±¡: ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³å“è³ªè¦æ±‚
mesh_quality: "ultra"
faces_target_count: 16000 (Step2), 150000 (Step3)
mesh_encoder.num_latents: 4096
generate_kwargs.max_new_tokens: 16384
generate_kwargs.num_beams: 80
```

### **âš¡ é«˜é€Ÿå“è³ªè¨­å®š**
```yaml
# å‡¦ç†æ™‚é–“: ç´„2-5åˆ†
# é©ç”¨å¯¾è±¡: ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ”ãƒ³ã‚°ãƒ»ãƒ†ã‚¹ãƒˆ
mesh_quality: "fast"
faces_target_count: 2000 (Step2), 20000 (Step3)
mesh_encoder.num_latents: 512
generate_kwargs.max_new_tokens: 2048
generate_kwargs.num_beams: 10
```

---

## ğŸ› ï¸ **å®Ÿè£…ï¼šå‹•çš„å“è³ªè¨­å®šã‚·ã‚¹ãƒ†ãƒ **

### **è¨­å®šåˆ‡ã‚Šæ›¿ãˆã‚¹ã‚¯ãƒªãƒ—ãƒˆä¾‹**

```python
# /app/mesh_quality_configurator.py
import yaml
from pathlib import Path
from typing import Literal

class MeshQualityConfigurator:
    """ãƒ¡ãƒƒã‚·ãƒ¥å“è³ªå‹•çš„è¨­å®šã‚·ã‚¹ãƒ†ãƒ """
    
    def __init__(self):
        self.config_base_dir = Path("/app/configs")
        self.quality_presets = {
            "fast": {
                "faces_target_count_step2": 2000,
                "faces_target_count_step3": 20000,
                "mesh_encoder_latents": 512,
                "max_new_tokens": 2048,
                "num_beams": 10,
                "temperature": 1.8
            },
            "standard": {
                "faces_target_count_step2": 4000,
                "faces_target_count_step3": 50000,
                "mesh_encoder_latents": 1024,
                "max_new_tokens": 4096,
                "num_beams": 20,
                "temperature": 1.5
            },
            "high": {
                "faces_target_count_step2": 8000,
                "faces_target_count_step3": 80000,
                "mesh_encoder_latents": 2048,
                "max_new_tokens": 8192,
                "num_beams": 40,
                "temperature": 1.2
            },
            "ultra": {
                "faces_target_count_step2": 16000,
                "faces_target_count_step3": 150000,
                "mesh_encoder_latents": 4096,
                "max_new_tokens": 16384,
                "num_beams": 80,
                "temperature": 0.8
            }
        }
    
    def apply_quality_preset(self, quality: Literal["fast", "standard", "high", "ultra"]):
        """å“è³ªãƒ—ãƒªã‚»ãƒƒãƒˆã‚’é©ç”¨"""
        preset = self.quality_presets[quality]
        
        # ã‚·ã‚¹ãƒ†ãƒ è¨­å®šæ›´æ–°
        self._update_system_config(preset)
        
        # ãƒ¢ãƒ‡ãƒ«è¨­å®šæ›´æ–°
        self._update_model_config(preset)
        
        # Step2/Step3ã«é¢æ•°è¨­å®šã‚’ä¼é”
        self._update_step_configs(preset)
        
        return f"å“è³ªè¨­å®š '{quality}' ã‚’é©ç”¨ã—ã¾ã—ãŸ"
    
    def _update_system_config(self, preset):
        """ã‚·ã‚¹ãƒ†ãƒ æ¨è«–è¨­å®šã‚’æ›´æ–°"""
        system_config_path = self.config_base_dir / "system/ar_inference_articulationxl.yaml"
        
        with open(system_config_path, 'r') as f:
            config = yaml.safe_load(f)
        
        config['generate_kwargs']['max_new_tokens'] = preset['max_new_tokens']
        config['generate_kwargs']['num_beams'] = preset['num_beams']
        config['generate_kwargs']['temperature'] = preset['temperature']
        
        with open(system_config_path, 'w') as f:
            yaml.dump(config, f, default_flow_style=False)
    
    def _update_model_config(self, preset):
        """ãƒ¢ãƒ‡ãƒ«è¨­å®šã‚’æ›´æ–°"""
        model_config_path = self.config_base_dir / "model/unirig_ar_350m_1024_81920_float32.yaml"
        
        with open(model_config_path, 'r') as f:
            config = yaml.safe_load(f)
        
        config['mesh_encoder']['num_latents'] = preset['mesh_encoder_latents']
        
        with open(model_config_path, 'w') as f:
            yaml.dump(config, f, default_flow_style=False)
    
    def _update_step_configs(self, preset):
        """Step2/Step3ã«é¢æ•°è¨­å®šã‚’ä¼é”"""
        # ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦è¨­å®šï¼ˆå®Ÿè¡Œæ™‚ã«å‚ç…§ï¼‰
        import os
        os.environ['UNIRIG_STEP2_FACES_COUNT'] = str(preset['faces_target_count_step2'])
        os.environ['UNIRIG_STEP3_FACES_COUNT'] = str(preset['faces_target_count_step3'])

# ä½¿ç”¨ä¾‹
configurator = MeshQualityConfigurator()
configurator.apply_quality_preset("high")  # é«˜å“è³ªè¨­å®šé©ç”¨
```

---

## ğŸ“Š **å“è³ª-å‡¦ç†æ™‚é–“-ãƒªã‚½ãƒ¼ã‚¹å¯¾ç…§è¡¨**

| å“è³ªè¨­å®š | Step2é¢æ•° | Step3é¢æ•° | æ¨è«–æ™‚é–“ | VRAMä½¿ç”¨é‡ | ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ | æ¨å¥¨ç”¨é€” |
|---------|-----------|-----------|----------|------------|-----------|----------|
| **fast** | 2,000 | 20,000 | 2-5åˆ† | 4GB | 500MB | ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ”ãƒ³ã‚° |
| **standard** | 4,000 | 50,000 | 5-10åˆ† | 8GB | 1GB | ä¸€èˆ¬ç”¨é€” |
| **high** | 8,000 | 80,000 | 15-30åˆ† | 12GB | 2GB | é«˜å“è³ªä½œå“ |
| **ultra** | 16,000 | 150,000 | 45-90åˆ† | 16GB+ | 4GB+ | ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ |

---

## ğŸ¯ **å“è³ªæœ€é©åŒ–æŒ‡é‡**

### **ğŸ“ˆ æ®µéšçš„å“è³ªå‘ä¸Šæˆ¦ç•¥**

1. **Step1: æ¨™æº–è¨­å®šã§åŸºæœ¬å‹•ä½œç¢ºèª**
   - ã¾ãš `standard` è¨­å®šã§å®Œå…¨ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®Ÿè¡Œ
   - çµæœå“è³ªã¨å‡¦ç†æ™‚é–“ã‚’è©•ä¾¡

2. **Step2: ç‰¹å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼èª¿æ•´**
   - `faces_target_count` ã®ã¿å€å¢—ï¼ˆ4000â†’8000ï¼‰
   - ä»–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã¯ç¶­æŒã—ã¦å½±éŸ¿ã‚’æ¸¬å®š

3. **Step3: åŒ…æ‹¬çš„å“è³ªå‘ä¸Š**
   - `high` ãƒ—ãƒªã‚»ãƒƒãƒˆé©ç”¨
   - AIæ¨è«–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼åŒæ™‚èª¿æ•´

4. **Step4: è¶…é«˜å“è³ªè¦æ±‚å¯¾å¿œ**
   - `ultra` ãƒ—ãƒªã‚»ãƒƒãƒˆé©ç”¨
   - ã‚«ã‚¹ã‚¿ãƒ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼å¾®èª¿æ•´

### **âš ï¸ å“è³ªèª¿æ•´æ™‚ã®æ³¨æ„äº‹é …**

```yaml
# âŒ é¿ã‘ã‚‹ã¹ãè¨­å®š
avoid:
  - faces_target_count > 200000  # ãƒ¡ãƒ¢ãƒªä¸è¶³ãƒªã‚¹ã‚¯
  - num_beams > 100             # æŒ‡æ•°çš„å‡¦ç†æ™‚é–“å¢—å¤§
  - temperature < 0.5           # å‰µé€ æ€§å®Œå…¨æŠ‘åˆ¶
  - max_new_tokens > 32768      # ãƒˆãƒ¼ã‚¯ãƒ³åˆ¶é™è¶…é

# âœ… æ¨å¥¨ã•ã‚Œã‚‹æ®µéšçš„èª¿æ•´
recommended_progression:
  1. faces_target_count: 4000 â†’ 6000 â†’ 8000
  2. num_beams: 20 â†’ 30 â†’ 40
  3. mesh_encoder.num_latents: 1024 â†’ 1536 â†’ 2048
```

---

## ğŸ”¬ **å“è³ªæ¤œè¨¼ãƒ»æ¸¬å®šã‚·ã‚¹ãƒ†ãƒ **

### **ãƒ¡ãƒƒã‚·ãƒ¥å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹**

```python
class MeshQualityMetrics:
    """ãƒ¡ãƒƒã‚·ãƒ¥å“è³ªæ¸¬å®šã‚·ã‚¹ãƒ†ãƒ """
    
    def analyze_mesh_quality(self, mesh_file_path: str) -> dict:
        """ãƒ¡ãƒƒã‚·ãƒ¥å“è³ªã®å®šé‡çš„åˆ†æ"""
        return {
            "vertex_count": self._count_vertices(mesh_file_path),
            "face_count": self._count_faces(mesh_file_path),
            "edge_length_stats": self._analyze_edge_lengths(mesh_file_path),
            "face_quality_score": self._calculate_face_quality(mesh_file_path),
            "mesh_density": self._calculate_mesh_density(mesh_file_path),
            "topology_health": self._check_topology_health(mesh_file_path)
        }
    
    def analyze_skeleton_quality(self, skeleton_fbx_path: str) -> dict:
        """ã‚¹ã‚±ãƒ«ãƒˆãƒ³å“è³ªã®å®šé‡çš„åˆ†æ"""
        return {
            "bone_count": self._count_bones(skeleton_fbx_path),
            "joint_hierarchy_depth": self._analyze_hierarchy_depth(skeleton_fbx_path),
            "bone_length_distribution": self._analyze_bone_lengths(skeleton_fbx_path),
            "symmetry_score": self._calculate_symmetry_score(skeleton_fbx_path),
            "anatomical_accuracy": self._assess_anatomical_accuracy(skeleton_fbx_path)
        }
```

---

## ğŸ“š **é–¢é€£è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§**

### **ğŸ”§ å¿…é ˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«**
```
configs/
â”œâ”€â”€ system/ar_inference_articulationxl.yaml          # æ¨è«–åˆ¶å¾¡
â”œâ”€â”€ model/unirig_ar_350m_1024_81920_float32.yaml     # ãƒ¢ãƒ‡ãƒ«è¨­å®š
â”œâ”€â”€ task/quick_inference_skeleton_articulationxl_ar_256.yaml  # Step2ã‚¿ã‚¹ã‚¯
â”œâ”€â”€ task/quick_inference_unirig_skin.yaml            # Step3ã‚¿ã‚¹ã‚¯
â”œâ”€â”€ data/quick_inference.yaml                        # ãƒ‡ãƒ¼ã‚¿å‡¦ç†
â””â”€â”€ components/tokenizer/tokenizer_parts_articulationxl_256.yaml  # ãƒˆãƒ¼ã‚¯ãƒŠã‚¤ã‚¶ãƒ¼
```

### **âš™ï¸ å®Ÿè¡Œæ™‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼**
```
Step2å®Ÿè¡Œ: python run.py --task configs/task/... --npz_dir dataset_inference_clean/{model_name}
Step3å®Ÿè¡Œ: python run.py --task configs/task/... --npz_dir dataset_inference_clean/{model_name}
ãƒ¡ãƒƒã‚·ãƒ¥æŠ½å‡º: python -m src.data.extract --faces_target_count {æ•°å€¤}
```

---

## ğŸ¯ **çµè«–**

UniRigã«ãŠã‘ã‚‹ãƒ¡ãƒƒã‚·ãƒ¥å“è³ªã¯ã€è¤‡æ•°ãƒ¬ãƒ™ãƒ«ã®æ´—ç·´ã•ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼åˆ¶å¾¡ã«ã‚ˆã£ã¦æ±ºå®šã•ã‚Œã¾ã™ã€‚**æœ€ã‚‚å½±éŸ¿åŠ›ã®å¤§ãã„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼**ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š

### **ğŸ† TOP5 å“è³ªæ±ºå®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼**

1. **`faces_target_count`** - ãƒ¡ãƒƒã‚·ãƒ¥è§£åƒåº¦ã®ç›´æ¥åˆ¶å¾¡
2. **`mesh_encoder.num_latents`** - AIç†è§£ç²¾åº¦ã®æ ¹å¹¹
3. **`generate_kwargs.max_new_tokens`** - ã‚¹ã‚±ãƒ«ãƒˆãƒ³è¤‡é›‘æ€§ä¸Šé™
4. **`generate_kwargs.num_beams`** - æ¢ç´¢ç²¾åº¦åˆ¶å¾¡
5. **`generate_kwargs.temperature`** - ç²¾åº¦vså‰µé€ æ€§ãƒãƒ©ãƒ³ã‚¹

### **ğŸš€ å“è³ªå‘ä¸Šã®æœ€çŸ­çµŒè·¯**

1. Step2ã® `faces_target_count` ã‚’ 4000â†’8000 ã«å€å¢—
2. `mesh_encoder.num_latents` ã‚’ 1024â†’2048 ã«å€å¢—  
3. `generate_kwargs.num_beams` ã‚’ 20â†’40 ã«å€å¢—

ã“ã‚Œã‚‰ã®èª¿æ•´ã«ã‚ˆã‚Šã€**å‡¦ç†æ™‚é–“ã®ç´„2-3å€å¢—åŠ **ã¨å¼•ãæ›ãˆã«ã€**å“è³ªã®å¤§å¹…å‘ä¸Š**ãŒæœŸå¾…ã§ãã¾ã™ã€‚

---

**ğŸ“‹ å®šæœŸçš„æ›´æ–°**

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€æ–°ã—ã„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ç™ºè¦‹ã‚„å“è³ªæ”¹å–„æ‰‹æ³•ã®é–‹ç™ºã«å¿œã˜ã¦å®šæœŸçš„ã«æ›´æ–°ã•ã‚Œã¾ã™ã€‚

**ä½œæˆè€…**: GitHub Copilot  
**æœ€çµ‚æ›´æ–°**: 2025å¹´6æœˆ17æ—¥  
**æ–‡æ›¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v1.0  
**é‡è¦åº¦**: æœ€é«˜ï¼ˆå“è³ªåˆ¶å¾¡ã®åŸºç›¤çŸ¥è­˜ï¼‰
