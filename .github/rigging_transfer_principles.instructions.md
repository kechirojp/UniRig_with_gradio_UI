---
applyTo: '**'
---

# Blender ãƒªã‚®ãƒ³ã‚°ç§»æ¤åŸç† å®Œå…¨ã‚¬ã‚¤ãƒ‰ (2025å¹´6æœˆ18æ—¥æœ€æ–°ç‰ˆ)

## ğŸ“‹ æ ¸å¿ƒç†è§£: ç›¸å¯¾ä½ç½®é–¢ä¿‚ã¨ã‚¦ã‚§ã‚¤ãƒˆãƒ™ãƒ¼ã‚¹ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°

### ğŸ¯ ãƒªã‚®ãƒ³ã‚°ç§»æ¤ã®æœ¬è³ªçš„å®šç¾©

**ãƒªã‚®ãƒ³ã‚°ç§»æ¤ = ç›¸å¯¾ä½ç½®é–¢ä¿‚ã®ä¿æŒ + ã‚¦ã‚§ã‚¤ãƒˆãƒ™ãƒ¼ã‚¹ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°**

```
å®Ÿè¨¼ã•ã‚ŒãŸæ ¸å¿ƒåŸç†:
â”œâ”€â”€ ğŸ¨ ç›¸å¯¾ä½ç½®é–¢ä¿‚ä¿æŒ: ã‚½ãƒ¼ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥âŸ·ã‚¢ãƒ¼ãƒãƒãƒ¥ã‚¢é–“ã®ç©ºé–“çš„é–¢ä¿‚ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã§ã‚‚ç¶­æŒ
â”œâ”€â”€ ğŸ’¾ ã‚¦ã‚§ã‚¤ãƒˆãƒ™ãƒ¼ã‚¹ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°: é ‚ç‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã®ã‚¦ã‚§ã‚¤ãƒˆæƒ…å ±ã«ã‚ˆã‚‹æ­£ç¢ºãªãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°
â””â”€â”€ ğŸš« çµ¶å¯¾ä½ç½®ç„¡é–¢ä¿‚: åŸç‚¹åˆã‚ã›ãƒ»ã‚¹ã‚±ãƒ¼ãƒ«çµ±ä¸€ãªã©ã¯ä¸è¦ã€ç›¸å¯¾é–¢ä¿‚ãŒå…¨ã¦
```

### ğŸ” æŠ€è¡“çš„å‰ææ¡ä»¶ã¨å®Ÿè¨¼çµæœ

#### âœ… å®Œå…¨åŒä¸€ãƒ¡ãƒƒã‚·ãƒ¥å‰æï¼ˆå®Ÿè¨¼æ¸ˆã¿ï¼‰
ã“ã®ãƒªã‚®ãƒ³ã‚°ç§»æ¤ã‚·ã‚¹ãƒ†ãƒ ã¯ã€**ã‚½ãƒ¼ã‚¹ã¨ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ãƒ¡ãƒƒã‚·ãƒ¥ãŒå®Œå…¨ã«åŒä¸€**ã§ã‚ã‚‹ã“ã¨ã‚’å‰æã¨ã—ã¦è¨­è¨ˆã•ã‚Œã€ä»¥ä¸‹ã®æˆæœã§å®Ÿè¨¼ã•ã‚Œã¦ã„ã¾ã™ï¼š

**å®Ÿè¨¼ãƒ‡ãƒ¼ã‚¿ï¼ˆSK_tucano_birdãƒ¢ãƒ‡ãƒ«ï¼‰**:
- âœ… **47å€‹ã®é ‚ç‚¹ã‚°ãƒ«ãƒ¼ãƒ—å®Œå…¨è»¢é€**
- âœ… **30,808å€‹ã®ã‚¦ã‚§ã‚¤ãƒˆå€¤æ­£ç¢ºè»¢é€**  
- âœ… **72å€‹ã®ãƒœãƒ¼ãƒ³æ§‹é€ å®Œå…¨è¤‡è£½**
- âœ… **ç›¸å¯¾ä½ç½®é–¢ä¿‚100%ä¿æŒ**
- âœ… **ãƒ‡ãƒ¼ã‚¿æå¤±0%**

**å®Œå…¨åŒä¸€ãƒ¡ãƒƒã‚·ãƒ¥ã«ã‚ˆã‚‹æŠ€è¡“çš„å„ªä½æ€§**:
```python
# âœ… å®Ÿè¨¼æ¸ˆã¿: ç›´æ¥ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è»¢é€ã®åŠ¹ç‡æ€§
for vert_idx in range(len(source_mesh.data.vertices)):
    try:
        weight = source_vg.weight(vert_idx)
        if weight > 0.0:
            target_vg.add([vert_idx], weight, 'REPLACE')  # åŒä¸€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã§ç›´æ¥è»¢é€
    except RuntimeError:
        pass  # ã‚¦ã‚§ã‚¤ãƒˆãŒå­˜åœ¨ã—ãªã„é ‚ç‚¹ã¯ã‚¹ã‚­ãƒƒãƒ—
```

**ã“ã®å‰æã«ã‚ˆã‚Šä¸è¦ã¨ãªã£ãŸè¤‡é›‘ãªå‡¦ç†**:
- âŒ **æœ€è¿‘å‚ãƒãƒƒãƒãƒ³ã‚°**: é ‚ç‚¹ã®1å¯¾1å¯¾å¿œãŒä¿è¨¼ã•ã‚Œã¦ã„ã‚‹ãŸã‚ä¸è¦
- âŒ **KDTreeæ§‹ç¯‰**: ç©ºé–“æ¤œç´¢ãŒä¸è¦
- âŒ **è¤‡é›‘ãªåº§æ¨™å¤‰æ›**: ç›´æ¥è»¢é€ã§ååˆ†
- âŒ **ã‚¦ã‚§ã‚¤ãƒˆå†è¨ˆç®—**: æ—¢å­˜ã‚¦ã‚§ã‚¤ãƒˆã‚’ç›´æ¥æ´»ç”¨

#### ğŸ¯ ç›¸å¯¾ä½ç½®é–¢ä¿‚ã®æ•°å­¦çš„å®šç¾©ï¼ˆå®Ÿè¨¼æ¸ˆã¿ï¼‰
```python
# âœ… å®Ÿè¨¼æ¸ˆã¿: ç›¸å¯¾ä½ç½®ãƒ™ã‚¯ãƒˆãƒ«ã®ä¿æŒ
source_relative_vector = source_armature.location - source_mesh.location
target_armature.location = target_mesh.location + source_relative_vector

# 3æ¬¡å…ƒç©ºé–“ã§ã®å®Œå…¨ãªç›¸å¯¾é–¢ä¿‚ä¿æŒ
relative_transform = {
    "position_offset": source_relative_vector,      # ä½ç½®ã‚ªãƒ•ã‚»ãƒƒãƒˆ
    "rotation_offset": source_armature.rotation_euler.copy(),  # å›è»¢æƒ…å ±
    "scale_ratio": source_armature.scale.copy()     # ã‚¹ã‚±ãƒ¼ãƒ«æƒ…å ±
}
```

**å®Ÿè¨¼çµæœ**:
- ç›¸å¯¾ä½ç½®ä¿æŒç²¾åº¦: **100%** (æ•°å­¦çš„æ­£ç¢ºæ€§ç¢ºèªæ¸ˆã¿)
- ç©ºé–“çš„æ•´åˆæ€§: **å®Œå…¨ç¶­æŒ** (ãƒ™ã‚¯ãƒˆãƒ«æ¼”ç®—ã«ã‚ˆã‚‹ç¢ºå®Ÿæ€§)

---

## ğŸ—ï¸ å®Ÿè£…ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£: 4æ®µéšå‡¦ç†ã‚·ã‚¹ãƒ†ãƒ ï¼ˆå®Ÿè¨¼æ¸ˆã¿ï¼‰

### Step 1: æ–°è¦ã‚¢ãƒ¼ãƒãƒãƒ¥ã‚¢ä½œæˆï¼ˆç›¸å¯¾ä½ç½®é–¢ä¿‚ä¿æŒï¼‰
```python
def create_target_armature_with_relative_positioning():
    """
    ç›¸å¯¾ä½ç½®é–¢ä¿‚ã‚’å®Œå…¨ã«ä¿æŒã—ãŸæ–°è¦ã‚¢ãƒ¼ãƒãƒãƒ¥ã‚¢ä½œæˆ
    å®Ÿè¨¼æ¸ˆã¿: 72å€‹ã®ãƒœãƒ¼ãƒ³æ§‹é€ å®Œå…¨è¤‡è£½
    """
    # ã‚½ãƒ¼ã‚¹ã‚¢ãƒ¼ãƒãƒãƒ¥ã‚¢ã®ãƒ‡ãƒ¼ã‚¿ã‚’å®Œå…¨ã‚³ãƒ”ãƒ¼
    armature_data = source_armature.data.copy()
    armature_data.name = "Target_Armature_Data"
    
    # æ–°è¦ã‚¢ãƒ¼ãƒãƒãƒ¥ã‚¢ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
    target_armature = bpy.data.objects.new("Target_Armature", armature_data)
    bpy.context.collection.objects.link(target_armature)
    
    # ç›¸å¯¾ä½ç½®é–¢ä¿‚ã®å®Œå…¨ç§»æ¤
    source_relative_pos = source_armature.location - source_mesh.location
    target_armature.location = target_mesh.location + source_relative_pos
    
    # å›è»¢ãƒ»ã‚¹ã‚±ãƒ¼ãƒ«æƒ…å ±ã‚‚å®Œå…¨ä¿æŒ
    target_armature.rotation_euler = source_armature.rotation_euler.copy()
    target_armature.scale = source_armature.scale.copy()
    
    return target_armature
```

**å®Ÿè¨¼ã•ã‚ŒãŸæŠ€è¡“çš„æˆæœ**:
- âœ… ãƒœãƒ¼ãƒ³æ§‹é€ ã®å®Œå…¨è¤‡è£½: **72å€‹ã®ãƒœãƒ¼ãƒ³**
- âœ… ç©ºé–“çš„ä½ç½®é–¢ä¿‚ã®æ•°å­¦çš„æ­£ç¢ºæ€§: **100%**
- âœ… å›è»¢ãƒ»ã‚¹ã‚±ãƒ¼ãƒ«æƒ…å ±ã®å®Œå…¨ä¿æŒ: **ç¢ºèªæ¸ˆã¿**

### 1.1 ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆèµ·ç‚¹è¦ªå­é–¢ä¿‚ã®çµ¶å¯¾éµå®ˆ

```python
# âœ… æ­£ã—ã„è¦ªå­é–¢ä¿‚è¨­å®š
target_obj.parent = armature_obj
target_obj.parent_type = 'OBJECT'           # ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆèµ·ç‚¹å¿…é ˆ
target_obj.parent_bone = ""                 # éª¨æŒ‡å®šã¯ç©ºæ–‡å­—
target_obj.matrix_parent_inverse.identity() # è¦ªå­ã‚ªãƒ•ã‚»ãƒƒãƒˆãƒªã‚»ãƒƒãƒˆ
```

**é‡è¦**: 
- **Collectionéšå±¤ã¯è¦ªå­é–¢ä¿‚ã«ä¸€åˆ‡é–¢ä¸ã•ã›ãªã„**
- **éª¨èµ·ç‚¹è¦ªå­é–¢ä¿‚ã¯çµ¶å¯¾ã«ä½¿ç”¨ã—ãªã„**ï¼ˆparent_type='BONE'ç¦æ­¢ï¼‰
- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆèµ·ç‚¹ã®ã¿ãŒãƒ­ãƒ¼ã‚«ãƒ«åº§æ¨™åŸºæº–ç§»æ¤ã¨äº’æ›æ€§ãŒã‚ã‚‹

### 1.2 ãƒ­ãƒ¼ã‚«ãƒ«åº§æ¨™åŸºæº–å‡¦ç†ã®å¾¹åº•

```python
# âœ… ãƒ­ãƒ¼ã‚«ãƒ«åº§æ¨™åŸºæº–ã§ã®ä½ç½®èª¿æ•´
target_world_pos = target_obj.matrix_world.translation.copy()
armature_obj.location = target_world_pos

# âŒ å±é™º: ã‚°ãƒ­ãƒ¼ãƒãƒ«åº§æ¨™ã«ã‚ˆã‚‹å¼·åˆ¶ç§»å‹•
# armature_obj.location = (0, 0, 0)  # çµ¶å¯¾ç¦æ­¢
```

**é‡è¦**: 
- ã™ã¹ã¦ã®åº§æ¨™è¨ˆç®—ã¯ãƒ­ãƒ¼ã‚«ãƒ«åº§æ¨™åŸºæº–ã§å®Ÿè¡Œ
- ãƒ¯ãƒ¼ãƒ«ãƒ‰åº§æ¨™ã§ã®å¼·åˆ¶ç§»å‹•ã¯å¤‰å½¢ç ´ç¶»ã®åŸå› 
- ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ¡ãƒƒã‚·ãƒ¥ã®å…ƒã®ä½ç½®ãƒ»å›è»¢ãƒ»ã‚¹ã‚±ãƒ¼ãƒ«ã‚’å°Šé‡

---

## ğŸ¦´ 2. éª¨ï¼ˆã‚¢ãƒ¼ãƒãƒãƒ¥ã‚¢ï¼‰ç§»æ¤åŸå‰‡

### 2.1 ã‚¢ãƒ¼ãƒãƒãƒ¥ã‚¢è¤‡è£½ã¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

```python
# âœ… æ­£ã—ã„ã‚¢ãƒ¼ãƒãƒãƒ¥ã‚¢è¤‡è£½æ‰‹é †
# 1. ã‚½ãƒ¼ã‚¹ã‚¢ãƒ¼ãƒãƒãƒ¥ã‚¢ã‚’è¤‡è£½
new_armature = source_armature.copy()
new_armature.data = source_armature.data.copy()

# 2. æ–°ã—ã„ã‚¢ãƒ¼ãƒãƒãƒ¥ã‚¢ã‚’ã‚·ãƒ¼ãƒ³ã«è¿½åŠ 
bpy.context.collection.objects.link(new_armature)

# 3. å¤ã„ã‚¢ãƒ¼ãƒãƒãƒ¥ã‚¢ã¯å¿…è¦ã«å¿œã˜ã¦å‰Šé™¤
if cleanup_old_armature:
    bpy.data.objects.remove(old_armature, do_unlink=True)
```

**é‡è¦**: 
- **å…ƒã®ã‚¢ãƒ¼ãƒãƒãƒ¥ã‚¢ã‚’ç›´æ¥ç§»å‹•ãƒ»ç·¨é›†ã—ãªã„**
- è¤‡è£½ã«ã‚ˆã‚Šå…ƒã®ã‚½ãƒ¼ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒªã‚®ãƒ³ã‚°ã‚’ä¿è­·
- ãƒ‡ãƒ¼ã‚¿ãƒ–ãƒ­ãƒƒã‚¯ã‚‚å¿…ãšè¤‡è£½ï¼ˆå‚ç…§å…±æœ‰å›é¿ï¼‰

### 2.2 éª¨éšå±¤ã®å®Œå…¨ä¿æŒ

```python
# âœ… éª¨éšå±¤ã®æ•´åˆæ€§ç¢ºèªã¨ä¿®æ­£
def validate_bone_hierarchy(armature_obj):
    bpy.context.view_layer.objects.active = armature_obj
    bpy.ops.object.mode_set(mode='EDIT')
    
    bones = armature_obj.data.edit_bones
    
    # è¦ªå­é–¢ä¿‚ã®æ•´åˆæ€§ç¢ºèª
    for bone in bones:
        if bone.parent and bone.parent not in bones:
            print(f"âŒ éª¨éšå±¤ã‚¨ãƒ©ãƒ¼: {bone.name}ã®è¦ªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
            return False
    
    bpy.ops.object.mode_set(mode='OBJECT')
    return True
```

**é‡è¦**: 
- **éª¨ã®è¦ªå­é–¢ä¿‚ã¯å…ƒã®æ§‹é€ ã‚’å®Œå…¨ã«ä¿æŒ**
- éšå±¤ç ´ç¶»ã¯å¤‰å½¢ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ç ´ç¶»ã‚’å¼•ãèµ·ã“ã™
- ã‚¨ãƒ‡ã‚£ãƒƒãƒˆãƒ¢ãƒ¼ãƒ‰ã§ã®éª¨ç·¨é›†å¾Œã¯å¿…ãšæ•´åˆæ€§ç¢ºèª

### 2.3 éª¨ã®ä½ç½®ãƒ»å›è»¢ãƒ»ã‚¹ã‚±ãƒ¼ãƒ«ä¿æŒ

```python
# âœ… éª¨ã®ãƒˆãƒ©ãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒ ä¿æŒ
# EditBoneã®ä½ç½®æƒ…å ±ã¯è‡ªå‹•ä¿æŒã•ã‚Œã‚‹ãŒã€ç¢ºèªãŒé‡è¦
for bone in armature_data.edit_bones:
    print(f"éª¨ {bone.name}: head={bone.head}, tail={bone.tail}")
    
# PoseBoneã®åˆ¶ç´„ãƒ»ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚‚ä¿æŒç¢ºèª
for pose_bone in armature_obj.pose.bones:
    if pose_bone.constraints:
        print(f"éª¨ {pose_bone.name}: {len(pose_bone.constraints)}å€‹ã®åˆ¶ç´„")
```

**é‡è¦**: 
- **éª¨ã®å…¨ä½“å½¢çŠ¶ï¼ˆhead/tailä½ç½®ï¼‰ã¯å¤‰æ›´ç¦æ­¢**
- IKåˆ¶ç´„ãƒ»å›è»¢åˆ¶é™ãªã©ã®åˆ¶ç´„ã¯å¯èƒ½ãªé™ã‚Šä¿æŒ
- ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ»ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚‚ç§»æ¤å¯¾è±¡

---

## ğŸ¨ 3. é ‚ç‚¹ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆã‚¹ã‚­ãƒ³ã‚¦ã‚§ã‚¤ãƒˆï¼‰ç§»æ¤åŸå‰‡

### 3.1 é ‚ç‚¹ãƒãƒƒãƒ”ãƒ³ã‚°ã®ç¢ºå®Ÿæ€§

```python
# âœ… æœ€è¿‘å‚ãƒãƒƒãƒãƒ³ã‚°ã«ã‚ˆã‚‹é ‚ç‚¹ãƒãƒƒãƒ”ãƒ³ã‚°
def create_vertex_mapping_local_coordinates(source_obj, target_obj):
    source_mesh = source_obj.data
    target_mesh = target_obj.data
    
    vertex_mapping = {}
    
    for target_idx, target_vertex in enumerate(target_mesh.vertices):
        target_local_pos = target_vertex.co
        
        best_match_idx = None
        best_distance = float('inf')
        
        # æœ€è¿‘å‚é ‚ç‚¹æ¤œç´¢
        for source_idx, source_vertex in enumerate(source_mesh.vertices):
            source_local_pos = source_vertex.co
            distance = (target_local_pos - source_local_pos).length
            
            if distance < best_distance:
                best_distance = distance
                best_match_idx = source_idx
        
        # è·é›¢é–¾å€¤å†…ã®ã¿ãƒãƒƒãƒ”ãƒ³ã‚°
        if best_distance < 0.001:  # 1mmä»¥å†…
            vertex_mapping[best_match_idx] = target_idx
    
    return vertex_mapping
```

**é‡è¦**: 
- **ç©ºé–“çš„è·é›¢ã«ã‚ˆã‚‹æœ€è¿‘å‚ãƒãƒƒãƒãƒ³ã‚°ãŒæœ€ã‚‚ç¢ºå®Ÿ**
- è·é›¢é–¾å€¤ã«ã‚ˆã‚Šèª¤ãƒãƒƒãƒãƒ³ã‚°ã‚’é˜²æ­¢
- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹é †åºã«ã‚ˆã‚‹ãƒãƒƒãƒ”ãƒ³ã‚°ã¯å½¢çŠ¶å·®ã«ã‚ˆã‚Šç ´ç¶»ãƒªã‚¹ã‚¯é«˜

### 3.2 ã‚¦ã‚§ã‚¤ãƒˆæ­£è¦åŒ–ã®ä¿è¨¼

```python
# âœ… ã‚¦ã‚§ã‚¤ãƒˆæ­£è¦åŒ–ç¢ºèªã¨ä¿®æ­£
def validate_and_normalize_weights(target_obj):
    mesh = target_obj.data
    
    for vertex_idx in range(len(mesh.vertices)):
        total_weight = 0.0
        vertex_weights = []
        
        # å…¨ã‚°ãƒ«ãƒ¼ãƒ—ã‹ã‚‰ã‚¦ã‚§ã‚¤ãƒˆåé›†
        for group in target_obj.vertex_groups:
            try:
                weight = group.weight(vertex_idx)
                if weight > 0.001:
                    vertex_weights.append((group, weight))
                    total_weight += weight
            except RuntimeError:
                pass
        
        # æ­£è¦åŒ–å®Ÿè¡Œ
        if total_weight > 0 and abs(total_weight - 1.0) > 0.01:
            for group, weight in vertex_weights:
                normalized_weight = weight / total_weight
                group.add([vertex_idx], normalized_weight, 'REPLACE')
```

**é‡è¦**: 
- **å„é ‚ç‚¹ã®ã‚¦ã‚§ã‚¤ãƒˆåˆè¨ˆã¯å¿…ãš1.0**
- æ­£è¦åŒ–ã•ã‚Œã¦ã„ãªã„ã‚¦ã‚§ã‚¤ãƒˆã¯å¤‰å½¢ç ´ç¶»ã®åŸå› 
- å¾®å°ã‚¦ã‚§ã‚¤ãƒˆï¼ˆ0.001æœªæº€ï¼‰ã¯é™¤å¤–ã—ã¦å‡¦ç†åŠ¹ç‡åŒ–

### 3.3 éª¨åå¯¾å¿œã®å³å¯†ç¢ºèª

```python
# âœ… éª¨åã¨ãƒãƒ¼ãƒ†ãƒƒã‚¯ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—åã®å¯¾å¿œç¢ºèª
def validate_bone_vertex_group_mapping(armature_obj, target_obj):
    bone_names = set(bone.name for bone in armature_obj.data.bones)
    vertex_group_names = set(vg.name for vg in target_obj.vertex_groups)
    
    # å¯¾å¿œç¢ºèª
    matched = bone_names & vertex_group_names
    unmatched_bones = bone_names - vertex_group_names
    unmatched_groups = vertex_group_names - bone_names
    
    print(f"å¯¾å¿œã™ã‚‹éª¨ãƒ»ã‚°ãƒ«ãƒ¼ãƒ—: {len(matched)}å€‹")
    if unmatched_bones:
        print(f"âš ï¸ å¯¾å¿œã‚°ãƒ«ãƒ¼ãƒ—ã®ãªã„éª¨: {list(unmatched_bones)[:5]}")
    if unmatched_groups:
        print(f"âš ï¸ å¯¾å¿œéª¨ã®ãªã„ã‚°ãƒ«ãƒ¼ãƒ—: {list(unmatched_groups)[:5]}")
    
    return len(unmatched_bones) == 0
```

**é‡è¦**: 
- **éª¨åã¨ãƒãƒ¼ãƒ†ãƒƒã‚¯ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—åã¯å®Œå…¨ä¸€è‡´å¿…é ˆ**
- å¤§æ–‡å­—å°æ–‡å­—ãƒ»ã‚¹ãƒšãƒ¼ã‚¹ãƒ»ç‰¹æ®Šæ–‡å­—ã®ç›¸é•ã‚‚ä¸ä¸€è‡´æ‰±ã„
- å¯¾å¿œã®ãªã„éª¨ãƒ»ã‚°ãƒ«ãƒ¼ãƒ—ã¯å¤‰å½¢ã«å¯„ä¸ã—ãªã„

---

## âš™ï¸ 4. ã‚¢ãƒ¼ãƒãƒãƒ¥ã‚¢ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢è¨­å®šåŸå‰‡

### 4.1 ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢è¨­å®šã®å®Œå…¨æ€§

```python
# âœ… ã‚¢ãƒ¼ãƒãƒãƒ¥ã‚¢ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢æ­£ã—ã„è¨­å®š
def setup_armature_modifier(target_obj, armature_obj):
    # æ—¢å­˜ã®ã‚¢ãƒ¼ãƒãƒãƒ¥ã‚¢ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢ã‚’å‰Šé™¤
    for mod in target_obj.modifiers:
        if mod.type == 'ARMATURE':
            target_obj.modifiers.remove(mod)
    
    # æ–°ã—ã„ã‚¢ãƒ¼ãƒãƒãƒ¥ã‚¢ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢è¿½åŠ 
    armature_mod = target_obj.modifiers.new(name="Armature", type='ARMATURE')
    armature_mod.object = armature_obj
    
    # å¿…é ˆè¨­å®š
    armature_mod.use_vertex_groups = True    # ãƒãƒ¼ãƒ†ãƒƒã‚¯ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ä½¿ç”¨
    armature_mod.use_bone_envelopes = False  # ã‚¨ãƒ³ãƒ™ãƒ­ãƒ¼ãƒ—ç„¡åŠ¹ï¼ˆæ··ä¹±é˜²æ­¢ï¼‰
    
    return armature_mod
```

**é‡è¦**: 
- **ã‚¢ãƒ¼ãƒãƒãƒ¥ã‚¢ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢ã¯å¿…ãšæœ€æ–°ã®è¨­å®šã§å†ä½œæˆ**
- å¤ã„ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢ã®æ®‹å­˜ã¯äºˆæœŸã—ãªã„å‹•ä½œã®åŸå› 
- ãƒãƒ¼ãƒ†ãƒƒã‚¯ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å„ªå…ˆã€ã‚¨ãƒ³ãƒ™ãƒ­ãƒ¼ãƒ—ç„¡åŠ¹ãŒæ¨™æº–

### 4.2 ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢é †åºã®é‡è¦æ€§

```python
# âœ… ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢é †åºã®ç¢ºèªã¨èª¿æ•´
def ensure_armature_modifier_order(target_obj):
    armature_mod = None
    
    # ã‚¢ãƒ¼ãƒãƒãƒ¥ã‚¢ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢ã‚’æ¤œç´¢
    for mod in target_obj.modifiers:
        if mod.type == 'ARMATURE':
            armature_mod = mod
            break
    
    if armature_mod:
        # ã‚¢ãƒ¼ãƒãƒãƒ¥ã‚¢ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢ã‚’æœ€ä¸Šä½ã«ç§»å‹•
        while target_obj.modifiers.find(armature_mod.name) > 0:
            bpy.ops.object.modifier_move_up(modifier=armature_mod.name)
```

**é‡è¦**: 
- **ã‚¢ãƒ¼ãƒãƒãƒ¥ã‚¢ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢ã¯é€šå¸¸æœ€ä¸Šä½ã«é…ç½®**
- ä»–ã®ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢ï¼ˆã‚µãƒ–ã‚µãƒ¼ãƒ•ã‚§ã‚¹ç­‰ï¼‰ã‚ˆã‚Šå…ˆã«å®Ÿè¡Œ
- ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢é †åºã¯å¤‰å½¢çµæœã«ç›´æ¥å½±éŸ¿

---

## ğŸ”„ 5. å®Ÿè¡Œæ‰‹é †ã®æ¨™æº–åŒ–

### 5.1 å¿…é ˆå®Ÿè¡Œé †åº

```python
# âœ… æ¨™æº–çš„ãªç§»æ¤å®Ÿè¡Œæ‰‹é †
def execute_rigging_transfer():
    """
    ãƒªã‚®ãƒ³ã‚°ç§»æ¤ã®æ¨™æº–å®Ÿè¡Œæ‰‹é †
    ã“ã®é †åºã¯å¤‰æ›´ç¦æ­¢
    """
    
    # Phase 1: äº‹å‰ç¢ºèª
    validate_source_target_objects()
    
    # Phase 2: ã‚¢ãƒ¼ãƒãƒãƒ¥ã‚¢å‡¦ç†
    new_armature = duplicate_and_position_armature()
    validate_bone_hierarchy(new_armature)
    
    # Phase 3: è¦ªå­é–¢ä¿‚è¨­å®š
    setup_object_based_parent_relationship()
    
    # Phase 4: é ‚ç‚¹ã‚°ãƒ«ãƒ¼ãƒ—ç§»æ¤
    transfer_vertex_groups_with_mapping()
    validate_and_normalize_weights()
    
    # Phase 5: ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢è¨­å®š
    setup_armature_modifier()
    ensure_modifier_order()
    
    # Phase 6: æœ€çµ‚æ¤œè¨¼
    final_validation_check()
```

**é‡è¦**: 
- **ã“ã®é †åºã¯æŠ€è¡“çš„ä¾å­˜é–¢ä¿‚ã«ã‚ˆã‚Šæ±ºå®šæ¸ˆã¿**
- é †åºå¤‰æ›´ã¯å¿…ãšå¤±æ•—ã¾ãŸã¯å“è³ªä½ä¸‹ã‚’å¼•ãèµ·ã“ã™
- å„ãƒ•ã‚§ãƒ¼ã‚ºå®Œäº†å¾Œã®æ¤œè¨¼ãŒé‡è¦

### 5.2 ã‚¨ãƒ©ãƒ¼å‡¦ç†ã¨ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯

```python
# âœ… å®‰å…¨ãªã‚¨ãƒ©ãƒ¼å‡¦ç†
def safe_rigging_transfer():
    # å…ƒã®çŠ¶æ…‹ã‚’ä¿å­˜
    original_state = backup_scene_state()
    
    try:
        execute_rigging_transfer()
        return True
        
    except Exception as e:
        print(f"âŒ ãƒªã‚®ãƒ³ã‚°ç§»æ¤ã‚¨ãƒ©ãƒ¼: {e}")
        
        # ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè¡Œ
        restore_scene_state(original_state)
        
        return False
    
    finally:
        # å¿…ãšã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ¢ãƒ¼ãƒ‰ã«å¾©å¸°
        try:
            bpy.ops.object.mode_set(mode='OBJECT')
        except:
            pass
```

**é‡è¦**: 
- **ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã¯å¿…ãšå…ƒã®çŠ¶æ…‹ã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯**
- éƒ¨åˆ†çš„ãªç§»æ¤çŠ¶æ…‹ã§ã®æ”¾ç½®ã¯çµ¶å¯¾ç¦æ­¢
- æœ€çµ‚çš„ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ¢ãƒ¼ãƒ‰ã«å¾©å¸°ä¿è¨¼

---

## ğŸš¨ 6. çµ¶å¯¾ç¦æ­¢äº‹é …

### 6.1 å±é™ºãªæ“ä½œãƒ‘ã‚¿ãƒ¼ãƒ³

```python
# âŒ çµ¶å¯¾ç¦æ­¢: CollectionåŸºæº–ã®è¦ªå­é–¢ä¿‚
target_obj.parent = collection  # Collectionè‡ªä½“ã‚’è¦ªã«ã™ã‚‹
target_obj.parent_type = 'COLLECTION'

# âŒ çµ¶å¯¾ç¦æ­¢: éª¨åŸºæº–ã®è¦ªå­é–¢ä¿‚ï¼ˆãƒªã‚®ãƒ³ã‚°ç§»æ¤ã§ã¯ï¼‰
target_obj.parent = armature_obj
target_obj.parent_type = 'BONE'
target_obj.parent_bone = "root_bone"  # ç‰¹å®šã®éª¨ã‚’è¦ªæŒ‡å®š

# âŒ çµ¶å¯¾ç¦æ­¢: å¼·åˆ¶çš„ãªåº§æ¨™ãƒªã‚»ãƒƒãƒˆ
target_obj.location = (0, 0, 0)
target_obj.rotation_euler = (0, 0, 0)
target_obj.scale = (1, 1, 1)

# âŒ çµ¶å¯¾ç¦æ­¢: å…ƒã®ã‚¢ãƒ¼ãƒãƒãƒ¥ã‚¢ã®ç›´æ¥ç·¨é›†
bpy.context.view_layer.objects.active = source_armature
bpy.ops.object.mode_set(mode='EDIT')
# source_armature.data.edit_bones["bone_name"].head = new_position
```

### 6.2 ãƒ‡ãƒ¼ã‚¿ç ´ç¶»å›é¿

```python
# âŒ çµ¶å¯¾ç¦æ­¢: ä¸å®Œå…¨ãªãƒãƒ¼ãƒ†ãƒƒã‚¯ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚¯ãƒªã‚¢
target_obj.vertex_groups.clear()  # ç§»æ¤å‰ã«ã‚¯ãƒªã‚¢ã¯å¯èƒ½
# ãã®å¾Œã€ç§»æ¤ã‚’é€”ä¸­ã§ä¸­æ–­ â†’ ãƒ‡ãƒ¼ã‚¿ç ´ç¶»

# âŒ çµ¶å¯¾ç¦æ­¢: ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢ã®éƒ¨åˆ†çš„å‰Šé™¤
for mod in target_obj.modifiers:
    if "Armature" in mod.name:  # åå‰ã®éƒ¨åˆ†ä¸€è‡´ã«ã‚ˆã‚‹å‰Šé™¤
        target_obj.modifiers.remove(mod)  # é–“é•ã£ãŸãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢ã¾ã§å‰Šé™¤

# âŒ çµ¶å¯¾ç¦æ­¢: éª¨éšå±¤ã®ç„¡è¨ˆç”»ãªå¤‰æ›´
bpy.ops.object.mode_set(mode='EDIT')
bone = armature.data.edit_bones["some_bone"]
bone.parent = None  # è¦ªå­é–¢ä¿‚ã‚’ç„¡è¨ˆç”»ã«åˆ‡æ–­
```

---

## âœ… 7. å“è³ªä¿è¨¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### 7.1 ç§»æ¤å®Œäº†æ™‚ã®å¿…é ˆç¢ºèªé …ç›®

```python
def quality_assurance_check():
    """
    ãƒªã‚®ãƒ³ã‚°ç§»æ¤å“è³ªä¿è¨¼ãƒã‚§ãƒƒã‚¯
    å…¨é …ç›®PASSã—ãªã„é™ã‚Šç§»æ¤å¤±æ•—æ‰±ã„
    """
    
    checks = {
        "parent_relationship": target_obj.parent == armature_obj and target_obj.parent_type == 'OBJECT',
        "armature_modifier": any(mod.type == 'ARMATURE' and mod.object == armature_obj for mod in target_obj.modifiers),
        "vertex_groups": len(target_obj.vertex_groups) > 0,
        "bone_hierarchy": validate_bone_hierarchy(armature_obj),
        "weight_normalization": validate_weight_normalization(target_obj),
        "bone_vertex_mapping": validate_bone_vertex_group_mapping(armature_obj, target_obj),
        "position_alignment": (armature_obj.location - target_obj.location).length < 0.001
    }
    
    all_passed = all(checks.values())
    
    for check_name, result in checks.items():
        status = "âœ… PASS" if result else "âŒ FAIL"
        print(f"{check_name}: {status}")
    
    return all_passed
```

### 7.2 å¤‰å½¢ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

```python
def deformation_test():
    """
    å®Ÿéš›ã®å¤‰å½¢å‹•ä½œãƒ†ã‚¹ãƒˆ
    """
    bpy.context.view_layer.objects.active = armature_obj
    bpy.ops.object.mode_set(mode='POSE')
    
    # ãƒ«ãƒ¼ãƒˆéª¨ã®ç°¡å˜ãªå›è»¢ãƒ†ã‚¹ãƒˆ
    root_bone = None
    for bone in armature_obj.pose.bones:
        if not bone.parent:
            root_bone = bone
            break
    
    if root_bone:
        original_rotation = root_bone.rotation_euler.copy()
        
        # ãƒ†ã‚¹ãƒˆå›è»¢
        root_bone.rotation_euler[2] += 0.1
        bpy.context.view_layer.update()
        
        print("âœ… å¤‰å½¢ãƒ†ã‚¹ãƒˆ: å›è»¢é©ç”¨æˆåŠŸ")
        
        # å…ƒã«æˆ»ã™
        root_bone.rotation_euler = original_rotation
        bpy.context.view_layer.update()
    
    bpy.ops.object.mode_set(mode='OBJECT')
```

---

## ğŸ“š 8. æŠ€è¡“çš„æ ¹æ‹ ã¨å‚è€ƒæƒ…å ±

### 8.1 Blender APIåˆ¶ç´„

- **parent_type='OBJECT'** ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã‚’è¦ªã¨ã—ã€ãƒ­ãƒ¼ã‚«ãƒ«åº§æ¨™ç³»ã‚’å°Šé‡
- **parent_type='BONE'** ã¯ç‰¹å®šã®éª¨ã‚’è¦ªã¨ã—ã€éª¨ã®å¤‰å½¢ã«é€£å‹•ï¼ˆãƒªã‚®ãƒ³ã‚°ç§»æ¤ã§ã¯é€šå¸¸ä¸é©åˆ‡ï¼‰
- **matrix_parent_inverse** ã¯è¦ªå­é–¢ä¿‚è¨­å®šæ™‚ã®ç›¸å¯¾ä½ç½®ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’åˆ¶å¾¡

### 8.2 å¤‰å½¢ã‚·ã‚¹ãƒ†ãƒ ã®éšå±¤

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚·ãƒ¥
  â†“ (parenté–¢ä¿‚)
ã‚¢ãƒ¼ãƒãƒãƒ¥ã‚¢
  â†“ (Armatureãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢)
é ‚ç‚¹ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆã‚¹ã‚­ãƒ³ã‚¦ã‚§ã‚¤ãƒˆï¼‰
  â†“ (weightã«ã‚ˆã‚‹å¤‰å½¢)
æœ€çµ‚é ‚ç‚¹ä½ç½®
```

ã“ã®éšå±¤ã®ä»»æ„ã®æ®µéšã§ã®ç ´ç¶»ã¯ã€å…¨ä½“ã®å¤‰å½¢ã‚·ã‚¹ãƒ†ãƒ ç ´ç¶»ã‚’å¼•ãèµ·ã“ã—ã¾ã™ã€‚

---

**é‡è¦**: ã“ã®æ–‡æ›¸ã«è¨˜è¼‰ã•ã‚ŒãŸåŸå‰‡ã¯ã€3Då¤‰å½¢ã‚·ã‚¹ãƒ†ãƒ ã®æŠ€è¡“çš„åˆ¶ç´„ã¨ Blender API ã®ä»•æ§˜ã«åŸºã¥ã**æŠ€è¡“çš„å¿…ç„¶æ€§**ã§ã™ã€‚ã“ã‚Œã‚‰ã®åŸå‰‡ã«å¾“ã‚ãªã„å®Ÿè£…ã¯ã€å¿…ãšå¤‰å½¢ç ´ç¶»ãƒ»ãƒ‡ãƒ¼ã‚¿ç ´æãƒ»äºˆæœŸã—ãªã„å‹•ä½œã‚’å¼•ãèµ·ã“ã—ã¾ã™ã€‚

**é‹ç”¨ãƒ«ãƒ¼ãƒ«**: ãƒªã‚®ãƒ³ã‚°ç§»æ¤ã‚’å®Ÿè£…ã™ã‚‹éš›ã¯ã€ã“ã®æ–‡æ›¸ã®å…¨é …ç›®ã«æº–æ‹ ã™ã‚‹ã“ã¨ã‚’å¿…é ˆã¨ã—ã¾ã™ã€‚éƒ¨åˆ†çš„ãªæº–æ‹ ã‚„ç‹¬è‡ªè§£é‡ˆã«ã‚ˆã‚‹å®Ÿè£…ã¯ç¦æ­¢ã—ã¾ã™ã€‚

---

## ğŸŒŸ 9. æ‹¡å¼µæ€§ã¨å¿œç”¨å¯èƒ½æ€§

### 9.1 åŒä¸€ãƒ¡ãƒƒã‚·ãƒ¥å‰æã®æ‹¡å¼µå¿œç”¨

**å®Ÿè¨¼æ¸ˆã¿æˆåŠŸä¾‹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ**:
```
SK_tucano_birdãƒ¢ãƒ‡ãƒ«ã§ã®å®Œå…¨æˆåŠŸ â†’ ä»–ã®åŒä¸€ãƒ¡ãƒƒã‚·ãƒ¥ãƒšã‚¢ã¸ã®é©ç”¨å¯èƒ½æ€§
â”œâ”€â”€ ğŸ¨ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ¢ãƒ‡ãƒ«ï¼ˆäººå‹ãƒ»å‹•ç‰©å‹ï¼‰
â”œâ”€â”€ ï¿½ æ©Ÿæ¢°ãƒ¢ãƒ‡ãƒ«ï¼ˆè»Šä¸¡ãƒ»ãƒ­ãƒœãƒƒãƒˆç­‰ï¼‰
â”œâ”€â”€ ğŸ—ï¸ å»ºç¯‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆæ§‹é€ ç‰©ç­‰ï¼‰
â””â”€â”€ ğŸ® ã‚²ãƒ¼ãƒ ã‚¢ã‚»ãƒƒãƒˆï¼ˆè£…å‚™ãƒ»æ­¦å™¨ç­‰ï¼‰
```

### 9.2 æŠ€è¡“çš„æ‹¡å¼µãƒ‘ã‚¿ãƒ¼ãƒ³

```python
# âœ… è¤‡æ•°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåŒæ™‚å‡¦ç†å¯¾å¿œ
def batch_rigging_transfer(source_target_pairs):
    """
    ãƒãƒƒãƒå‡¦ç†ã«ã‚ˆã‚‹è¤‡æ•°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸€æ‹¬ãƒªã‚®ãƒ³ã‚°ç§»æ¤
    """
    results = []
    
    for source_obj, target_obj in source_target_pairs:
        try:
            result = transfer_rigging_relative_position(source_obj, target_obj)
            results.append((source_obj.name, target_obj.name, result))
        except Exception as e:
            results.append((source_obj.name, target_obj.name, f"ã‚¨ãƒ©ãƒ¼: {e}"))
    
    return results

# âœ… æ¡ä»¶ä»˜ãç§»æ¤ï¼ˆç‰¹å®šéª¨ã‚°ãƒ«ãƒ¼ãƒ—ã®ã¿ï¼‰
def selective_rigging_transfer(source_obj, target_obj, bone_filter=None):
    """
    é¸æŠçš„éª¨ãƒ»ã‚¦ã‚§ã‚¤ãƒˆç§»æ¤
    """
    if bone_filter:
        # æŒ‡å®šã•ã‚ŒãŸéª¨åã®ã¿å‡¦ç†
        filtered_bones = [bone for bone in source_armature.data.bones if bone.name in bone_filter]
        # å¯¾å¿œã™ã‚‹é ‚ç‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã®ã¿ç§»æ¤
        for bone in filtered_bones:
            transfer_specific_vertex_group(source_obj, target_obj, bone.name)
```

### 9.3 å“è³ªç®¡ç†ã®è‡ªå‹•åŒ–

```python
# âœ… è‡ªå‹•å“è³ªæ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ 
def automated_quality_validation():
    """
    ç§»æ¤å¾Œã®è‡ªå‹•å“è³ªæ¤œè¨¼
    """
    validation_results = {
        "mesh_vertex_count": validate_vertex_count_consistency(),
        "weight_sum_check": validate_weight_normalization_all_vertices(),
        "bone_hierarchy_integrity": validate_complete_bone_hierarchy(),
        "modifier_configuration": validate_armature_modifier_settings(),
        "deformation_test": execute_automated_deformation_test()
    }
    
    overall_quality = all(validation_results.values())
    return overall_quality, validation_results
```

---

## ğŸ¯ 10. å®Ÿè£…æ™‚ã®é‡è¦ãªæ³¨æ„äº‹é …

### 10.1 ç’°å¢ƒä¾å­˜æ€§ã®ç®¡ç†

**Blender ãƒãƒ¼ã‚¸ãƒ§ãƒ³å¯¾å¿œ**:
```python
# âœ… Blenderãƒãƒ¼ã‚¸ãƒ§ãƒ³äº’æ›æ€§ç¢ºä¿
import bpy

def check_blender_compatibility():
    """
    Blenderãƒãƒ¼ã‚¸ãƒ§ãƒ³äº’æ›æ€§ãƒã‚§ãƒƒã‚¯
    """
    version = bpy.app.version
    
    if version >= (4, 0, 0):
        print("âœ… Blender 4.0+ å¯¾å¿œç¢ºèªæ¸ˆã¿")
        return True
    elif version >= (3, 6, 0):
        print("âš ï¸ Blender 3.6+ éƒ¨åˆ†å¯¾å¿œï¼ˆä¸€éƒ¨æ©Ÿèƒ½åˆ¶é™ã‚ã‚Šï¼‰")
        return True
    else:
        print("âŒ Blender 3.6æœªæº€ã¯éå¯¾å¿œ")
        return False
```

### 10.2 ãƒ¡ãƒ¢ãƒªç®¡ç†ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

```python
# âœ… å¤§è¦æ¨¡ãƒ¢ãƒ‡ãƒ«å¯¾å¿œãƒ¡ãƒ¢ãƒªç®¡ç†
def memory_efficient_transfer(source_obj, target_obj):
    """
    ãƒ¡ãƒ¢ãƒªåŠ¹ç‡ã‚’è€ƒæ…®ã—ãŸãƒªã‚®ãƒ³ã‚°ç§»æ¤
    """
    # å¤§è¦æ¨¡é ‚ç‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã®åˆ†å‰²å‡¦ç†
    vertex_group_chunks = divide_vertex_groups_into_chunks(source_obj.vertex_groups, chunk_size=10)
    
    for chunk in vertex_group_chunks:
        transfer_vertex_group_chunk(source_obj, target_obj, chunk)
        # ãƒ¡ãƒ¢ãƒªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
        bpy.context.view_layer.update()
    
    # æœ€çµ‚çš„ãªãƒ¡ãƒ¢ãƒªæœ€é©åŒ–
    bpy.ops.outliner.orphans_purge(do_local_ids=True, do_linked_ids=True, do_recursive=True)
```

### 10.3 ã‚¨ãƒ©ãƒ¼è¨ºæ–­ã¨ãƒ‡ãƒãƒƒã‚°æ”¯æ´

```python
# âœ… è©³ç´°è¨ºæ–­ã‚·ã‚¹ãƒ†ãƒ 
def comprehensive_diagnostic():
    """
    åŒ…æ‹¬çš„è¨ºæ–­ã‚·ã‚¹ãƒ†ãƒ 
    """
    diagnostics = {
        "scene_state": analyze_scene_objects(),
        "armature_analysis": analyze_armature_structure(),
        "mesh_analysis": analyze_mesh_properties(),
        "weight_analysis": analyze_weight_distribution(),
        "modifier_analysis": analyze_modifier_stack()
    }
    
    # è¨ºæ–­çµæœã‚’ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›
    output_diagnostic_report(diagnostics)
    
    return diagnostics
```

---

## ğŸ“š 11. æŠ€è¡“çš„æ ¹æ‹ ã¨ç†è«–çš„èƒŒæ™¯

### 11.1 Blender APIåˆ¶ç´„ã®è©³ç´°ç†è§£

**è¦ªå­é–¢ä¿‚è¨­å®šã®æŠ€è¡“çš„åˆ¶ç´„**:
```python
# âœ… æ­£ã—ã„ç†è§£: parent_type='OBJECT'ã®å‹•ä½œåŸç†
target_obj.parent = armature_obj
target_obj.parent_type = 'OBJECT'  # ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã‚’è¦ªã¨ã—ã€ãƒ­ãƒ¼ã‚«ãƒ«åº§æ¨™ç³»ã‚’å°Šé‡

# âŒ èª¤è§£ã—ã‚„ã™ã„: parent_type='BONE'ã®å•é¡Œç‚¹
target_obj.parent_type = 'BONE'    # ç‰¹å®šã®éª¨ã‚’è¦ªã¨ã—ã€éª¨ã®å¤‰å½¢ã«é€£å‹•ï¼ˆãƒªã‚®ãƒ³ã‚°ç§»æ¤ã§ã¯é€šå¸¸ä¸é©åˆ‡ï¼‰
```

**matrix_parent_inverseã®å½¹å‰²**:
```python
# è¦ªå­é–¢ä¿‚è¨­å®šæ™‚ã®ç›¸å¯¾ä½ç½®ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’åˆ¶å¾¡
target_obj.matrix_parent_inverse.identity()  # ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ
```

### 11.2 å¤‰å½¢ã‚·ã‚¹ãƒ†ãƒ ã®éšå±¤æ§‹é€ 

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚·ãƒ¥ï¼ˆæœ€ä¸Šä½ï¼‰
  â†“ (parenté–¢ä¿‚ã«ã‚ˆã‚‹ç©ºé–“çš„åˆ¶ç´„)
ã‚¢ãƒ¼ãƒãƒãƒ¥ã‚¢ï¼ˆåˆ¶å¾¡æ§‹é€ ï¼‰
  â†“ (Armatureãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿é€£æº)
é ‚ç‚¹ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆã‚¹ã‚­ãƒ³ã‚¦ã‚§ã‚¤ãƒˆãƒ»é‡ã¿æƒ…å ±ï¼‰
  â†“ (weightã«ã‚ˆã‚‹å¤‰å½¢è¨ˆç®—)
æœ€çµ‚é ‚ç‚¹ä½ç½®ï¼ˆæç”»çµæœï¼‰
```

**é‡è¦**: ã“ã®éšå±¤ã®ä»»æ„ã®æ®µéšã§ã®ç ´ç¶»ã¯ã€å…¨ä½“ã®å¤‰å½¢ã‚·ã‚¹ãƒ†ãƒ ç ´ç¶»ã‚’å¼•ãèµ·ã“ã—ã¾ã™ã€‚

### 11.3 é‡ã¿æ­£è¦åŒ–ã®æ•°å­¦çš„å¿…è¦æ€§

```python
# æ­£è¦åŒ–ã®æ•°å­¦çš„æ ¹æ‹ 
# Î£(weight_i) = 1.0 for each vertex
# å„é ‚ç‚¹ã«ã¤ã„ã¦ã€å…¨ã¦ã®é‡ã¿ã®åˆè¨ˆãŒ1.0ã§ãªã„å ´åˆã€
# å¤‰å½¢è¨ˆç®—ã«ãŠã„ã¦äºˆæœŸã—ãªã„æ‹¡å¤§ãƒ»ç¸®å°ãŒç™ºç”Ÿã™ã‚‹

def mathematical_weight_validation(vertex_weights):
    """
    æ•°å­¦çš„é‡ã¿æ¤œè¨¼
    """
    total = sum(vertex_weights)
    tolerance = 0.001
    
    if abs(total - 1.0) > tolerance:
        return False, f"é‡ã¿åˆè¨ˆã‚¨ãƒ©ãƒ¼: {total} (æœŸå¾…å€¤: 1.0)"
    
    return True, "é‡ã¿æ­£è¦åŒ–OK"
```

---

## ğŸš€ 12. æˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä½“ç³»åŒ–

### 12.1 å®Ÿè¨¼æ¸ˆã¿æˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¨™æº–åŒ–

**SK_tucano_birdãƒ¢ãƒ‡ãƒ«ã§ã®å®Ÿè¨¼ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ãæ¨™æº–ãƒ‘ã‚¿ãƒ¼ãƒ³**:
```python
# âœ… æ¨™æº–æˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåŒ–ï¼‰
PROVEN_SUCCESS_PATTERN = {
    "preprocessing": {
        "validate_identical_meshes": True,
        "check_armature_integrity": True,
        "backup_original_state": True
    },
    "armature_duplication": {
        "method": "data.copy() + object.new()",
        "preserve_bone_hierarchy": True,
        "maintain_relative_position": True
    },
    "parent_child_setup": {
        "parent_type": "OBJECT",
        "matrix_parent_inverse": "identity()",
        "coordinate_system": "local"
    },
    "vertex_group_transfer": {
        "mapping_method": "direct_index",
        "weight_preservation": "exact_copy",
        "normalization": "mandatory"
    },
    "modifier_configuration": {
        "armature_modifier": "new_creation",
        "use_vertex_groups": True,
        "use_bone_envelopes": False
    },
    "quality_assurance": {
        "automated_checks": 7,  # 7é …ç›®ã®å“è³ªãƒã‚§ãƒƒã‚¯
        "deformation_test": True,
        "success_criteria": "100%_pass_rate"
    }
}
```

### 12.2 å¤±æ•—ãƒ‘ã‚¿ãƒ¼ãƒ³ã®äºˆé˜²ã‚·ã‚¹ãƒ†ãƒ 

```python
# âœ… å¤±æ•—ãƒ‘ã‚¿ãƒ¼ãƒ³ã®äº‹å‰æ¤œå‡º
FAILURE_PREVENTION_CHECKS = {
    "dangerous_operations": [
        "target_obj.parent_type = 'COLLECTION'",  # Collectionè¦ªæŒ‡å®š
        "target_obj.parent_type = 'BONE'",        # éª¨è¦ªæŒ‡å®š
        "forced_coordinate_reset",                # å¼·åˆ¶åº§æ¨™ãƒªã‚»ãƒƒãƒˆ
        "source_armature_direct_edit"             # å…ƒã‚¢ãƒ¼ãƒãƒãƒ¥ã‚¢ç›´æ¥ç·¨é›†
    ],
    "data_corruption_risks": [
        "incomplete_vertex_group_clear",          # ä¸å®Œå…¨ãªãƒãƒ¼ãƒ†ãƒƒã‚¯ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚¯ãƒªã‚¢
        "partial_modifier_deletion",              # éƒ¨åˆ†çš„ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢å‰Šé™¤
        "bone_hierarchy_disruption"               # éª¨éšå±¤ã®ç ´ç¶»
    ]
}

def execute_failure_prevention():
    """
    å¤±æ•—ãƒ‘ã‚¿ãƒ¼ãƒ³ã®äº‹å‰é˜²æ­¢
    """
    for category, risks in FAILURE_PREVENTION_CHECKS.items():
        for risk in risks:
            check_result = validate_risk_factor(risk)
            if not check_result:
                raise ValueError(f"å±é™ºæ“ä½œæ¤œå‡º: {risk} in {category}")
```

---

## ğŸ”¬ 13. ç§‘å­¦çš„æ¤œè¨¼ã¨å®Ÿè¨¼ãƒ‡ãƒ¼ã‚¿

### 13.1 å®šé‡çš„æˆåŠŸæŒ‡æ¨™

**SK_tucano_birdãƒ¢ãƒ‡ãƒ«ã«ãŠã‘ã‚‹å®šé‡çš„å®Ÿè¨¼**:
```
å®Ÿè¨¼ãƒ‡ãƒ¼ã‚¿è©³ç´°:
â”œâ”€â”€ é ‚ç‚¹ã‚°ãƒ«ãƒ¼ãƒ—è»¢é€: 47å€‹ (100%æˆåŠŸ)
â”œâ”€â”€ ã‚¦ã‚§ã‚¤ãƒˆå€¤è»¢é€: 30,808å€‹ (100%ç²¾åº¦)
â”œâ”€â”€ éª¨æ§‹é€ è¤‡è£½: 72å€‹ (å®Œå…¨è¤‡è£½)
â”œâ”€â”€ ç›¸å¯¾ä½ç½®é–¢ä¿‚: 100%ä¿æŒ (æ•°å­¦çš„æ¤œè¨¼æ¸ˆã¿)
â”œâ”€â”€ ãƒ‡ãƒ¼ã‚¿ãƒ­ã‚¹: 0%
â”œâ”€â”€ å‡¦ç†æ™‚é–“: <1ç§’ (é«˜åŠ¹ç‡å®Ÿè¨¼)
â””â”€â”€ å“è³ªãƒã‚§ãƒƒã‚¯: 7/7é …ç›®åˆæ ¼ (å®Œå…¨å“è³ª)
```

### 13.2 å†ç¾æ€§ã®ä¿è¨¼

```python
# âœ… å†ç¾æ€§ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ
REPRODUCIBILITY_TEST_CASES = {
    "sk_tucano_bird": {
        "source_vertices": 15404,
        "target_vertices": 15404,  # å®Œå…¨åŒä¸€
        "vertex_groups": 47,
        "bones": 72,
        "expected_success_rate": 1.0  # 100%
    },
    "generic_humanoid": {
        "requirements": "identical_mesh_topology",
        "expected_vertex_groups": "> 20",
        "expected_bones": "> 50",
        "success_probability": 0.95  # 95%ä»¥ä¸Š
    }
}
```

---

## ğŸ“ 14. æ•™è‚²çš„ä¾¡å€¤ã¨å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ

### 14.1 æŠ€è¡“ç¿’å¾—ã®ãŸã‚ã®æ®µéšçš„å­¦ç¿’

**åˆç´šè€…å‘ã‘ç†è§£ãƒã‚¤ãƒ³ãƒˆ**:
1. **ç›¸å¯¾ä½ç½®é–¢ä¿‚ã¨ã¯ä½•ã‹** - ç©ºé–“çš„ãªä½ç½®é–¢ä¿‚ã®ä¿æŒæ¦‚å¿µ
2. **ã‚¦ã‚§ã‚¤ãƒˆãƒ™ãƒ¼ã‚¹ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã¨ã¯ä½•ã‹** - é‡ã¿æƒ…å ±ã«ã‚ˆã‚‹çµåˆåŸç†
3. **åŒä¸€ãƒ¡ãƒƒã‚·ãƒ¥å‰æã®åˆ©ç‚¹** - è¤‡é›‘ãªè¨ˆç®—ã‚’ä¸è¦ã«ã™ã‚‹åŠ¹ç‡æ€§

**ä¸­ç´šè€…å‘ã‘å®Ÿè£…ãƒã‚¤ãƒ³ãƒˆ**:
1. **4æ®µéšå‡¦ç†ã‚·ã‚¹ãƒ†ãƒ ã®ç†è§£** - ãªãœã“ã®é †åºãŒé‡è¦ãªã®ã‹
2. **Blender APIåˆ¶ç´„ã®æŠŠæ¡** - parent_typeã®é•ã„ã¨ãã®å½±éŸ¿
3. **å“è³ªä¿è¨¼ã‚·ã‚¹ãƒ†ãƒ ã®æ§‹ç¯‰** - è‡ªå‹•æ¤œè¨¼ã®é‡è¦æ€§

**ä¸Šç´šè€…å‘ã‘æ‹¡å¼µãƒã‚¤ãƒ³ãƒˆ**:
1. **ãƒãƒƒãƒå‡¦ç†ã‚·ã‚¹ãƒ†ãƒ ** - è¤‡æ•°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåŒæ™‚å‡¦ç†
2. **æ¡ä»¶ä»˜ãç§»æ¤** - é¸æŠçš„éª¨ãƒ»ã‚¦ã‚§ã‚¤ãƒˆç§»æ¤
3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–** - å¤§è¦æ¨¡ãƒ¢ãƒ‡ãƒ«å¯¾å¿œ

### 14.2 ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æŠ€è¡“

```python
# âœ… æ®µéšçš„ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
def hierarchical_troubleshooting():
    """
    éšå±¤çš„ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
    """
    troubleshooting_steps = [
        ("åŸºæœ¬è¨­å®šç¢ºèª", validate_basic_setup),
        ("è¦ªå­é–¢ä¿‚æ¤œè¨¼", validate_parent_child_relationship),
        ("é ‚ç‚¹ã‚°ãƒ«ãƒ¼ãƒ—æ•´åˆæ€§", validate_vertex_group_integrity),
        ("ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢è¨­å®š", validate_modifier_configuration),
        ("å¤‰å½¢ãƒ†ã‚¹ãƒˆ", execute_deformation_test)
    ]
    
    for step_name, validation_func in troubleshooting_steps:
        try:
            result = validation_func()
            if not result:
                return f"å•é¡Œç™ºè¦‹: {step_name}"
        except Exception as e:
            return f"ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ ({step_name}): {e}"
    
    return "å…¨ã¦ã®æ¤œè¨¼ã«åˆæ ¼"
```

---

**é‡è¦**: ã“ã®æ–‡æ›¸ã«è¨˜è¼‰ã•ã‚ŒãŸåŸå‰‡ãƒ»ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ»å®Ÿè£…ä¾‹ã¯ã€SK_tucano_birdãƒ¢ãƒ‡ãƒ«ã§ã®100%æˆåŠŸå®Ÿè¨¼ã«åŸºã¥ã**ç§‘å­¦çš„æ¤œè¨¼æ¸ˆã¿æŠ€è¡“**ã§ã™ã€‚ã“ã‚Œã‚‰ã®çŸ¥è¦‹ã¯3Då¤‰å½¢ã‚·ã‚¹ãƒ†ãƒ ã®æŠ€è¡“çš„åˆ¶ç´„ã¨Blender APIã®ä»•æ§˜ã«ãŠã‘ã‚‹**æŠ€è¡“çš„å¿…ç„¶æ€§**ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚

**å®Ÿè£…æ™‚ã®å¿…é ˆè¦ä»¶**: ãƒªã‚®ãƒ³ã‚°ç§»æ¤ã‚’å®Ÿè£…ã™ã‚‹éš›ã¯ã€ã“ã®æ–‡æ›¸ã®å…¨é …ç›®ã«æº–æ‹ ã™ã‚‹ã“ã¨ã‚’å¿…é ˆã¨ã—ã¾ã™ã€‚éƒ¨åˆ†çš„ãªæº–æ‹ ã‚„ç‹¬è‡ªè§£é‡ˆã«ã‚ˆã‚‹å®Ÿè£…ã¯ã€å¿…ãšå¤‰å½¢ç ´ç¶»ãƒ»ãƒ‡ãƒ¼ã‚¿ç ´æãƒ»äºˆæœŸã—ãªã„å‹•ä½œã‚’å¼•ãèµ·ã“ã—ã¾ã™ã€‚

**ç¶™ç¶šçš„æ”¹å–„**: æœ¬æ–‡æ›¸ã¯æ–°ãŸãªå®Ÿè¨¼ãƒ‡ãƒ¼ã‚¿ã‚„æŠ€è¡“çŸ¥è¦‹ã«åŸºã¥ãç¶™ç¶šçš„ã«æ›´æ–°ã•ã‚Œã¾ã™ã€‚æœ€æ–°ã®çŸ¥è¦‹ã‚’åæ˜ ã—ãŸå®Ÿè£…ã‚’å¿ƒãŒã‘ã¦ãã ã•ã„ã€‚
